<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/webgl-3d-perspective-correct-texturemapping.md. Do not edited directly -->
<!--
Copyright 2021 GFXFundamentals.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of GFXFundamentals. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="What&#x27;s special about W">
<meta name="keywords" content="webgl graphics">
<meta name="thumbnail" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective-correct-texturemapping_en.jpg">

<meta property="og:title" content="WebGL 3D Perspective Correct Texture Mapping">
<meta property="og:type" content="website">
<meta property="og:image" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective-correct-texturemapping_en.jpg">
<meta property="og:description" content="What&#x27;s special about W">
<meta property="og:url" content="https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html">

<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:site" content="@greggman">
<meta name="twitter:creator" content="@greggman">
<meta name="twitter:domain" content="webglfundamentals.org">
<meta name="twitter:title" content="WebGL 3D Perspective Correct Texture Mapping">
<meta name="twitter:url" content="https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html">
<meta name="twitter:description" content="What&#x27;s special about W">
<meta name="twitter:image:src" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective-correct-texturemapping_en.jpg">

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webglfundamentals.org/#website",
      "url":"https://webglfundamentals.org/",
      "name":"WebglFundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html#primaryimage",
      "url":"https://webglfundamentals.org/webgl/lessons/screenshots/webgl-3d-perspective-correct-texturemapping_en.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html#webpage",
      "url":"https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html",
      "inLanguage":"en",
      "name":"WebGL 3D Perspective Correct Texture Mapping",
      "keywords":"webgl graphics programming",
      "isPartOf":{
        "@id":"https://webglfundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGL 3D Perspective Correct Texture Mapping</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/lang.css">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css">

  <link rel="alternate" hreflang="en" href="https://webglfundamentals.org/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="fr" href="https://webglfundamentals.org/webgl/lessons/fr/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="ja" href="https://webglfundamentals.org/webgl/lessons/ja/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="ko" href="https://webglfundamentals.org/webgl/lessons/ko/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="pl" href="https://webglfundamentals.org/webgl/lessons/pl/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="pt-br" href="https://webglfundamentals.org/webgl/lessons/pt-br/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="ru" href="https://webglfundamentals.org/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="uk" href="https://webglfundamentals.org/webgl/lessons/uk/webgl-3d-perspective-correct-texturemapping.html">
  <link rel="alternate" hreflang="zh_cn" href="https://webglfundamentals.org/webgl/lessons/zh_cn/webgl-3d-perspective-correct-texturemapping.html">




</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html" selected>English</a>
    <option value="/webgl/lessons/fr/webgl-3d-perspective-correct-texturemapping.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-3d-perspective-correct-texturemapping.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-perspective-correct-texturemapping.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-3d-perspective-correct-texturemapping.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-perspective-correct-texturemapping.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html" >Русский</a>
    <option value="/webgl/lessons/uk/webgl-3d-perspective-correct-texturemapping.html" >Українська</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-perspective-correct-texturemapping.html" >简体中文</a>
</select>


    <a href="#toc">Table of Contents</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/">WebGLFundamentals.org</a></h1>
<style>
#forkongithub>div {
    background: #000;
    color: #fff;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 1.3rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 400px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(200px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a {
  text-decoration: none;
  color: #fff;
}
#forkongithub>div:hover {
    background: #c11;
    color: #fff;
}
#forkongithub .contributors {
  font-size: 0.75rem;
  background: rgba(255,255,255,0.2);
  line-height: 1.2;
  padding: 0.1em;
}
#forkongithub>div::before,#forkongithub>div::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub>div::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
#forkongithub img {
  width: 1em;
  height: 1em;
  border-radius: 100%;
  vertical-align: middle;
}

@media (max-width: 900px) {
    #forkongithub>div {
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub>div {
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><div><div><a href="https://github.com/gfxfundamentals/webgl-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div></div></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL 3D Perspective Correct Texture Mapping</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>This post is a continuation of a series of posts about WebGL.  The first
<a href="webgl-fundamentals.html">started with fundamentals</a>. This article
covers perspective correct texture mapping. To understand it you 
probably need to read up on <a href="webgl-3d-perspective.html">perspective projection</a> and maybe <a href="webgl-3d-textures.html">texturing</a>
as well. You also need to know about <a href="webgl-how-it-works.html">varyings and what they do</a> but I&#39;ll cover them briefly here.</p>
<p>So in the &quot;<a href="webgl-how-it-works.html">how it works</a>&quot; article
we covered how varyings work. A vertex shader can declare a
varying and set it to some value. Once the vertex shader has been called
3 times WebGL will draw a triangle. While it&#39;s drawing that triangle
for every pixel it will call our fragment shader and ask it what
color to make that pixel. Between the 3 vertices of the triangle
it will pass us our varyings interpolated between the 3 values.</p>
<p><div class="webgl_diagram_container">
  <iframe class="webgl_example " style="width: 600px; height: 400px;" src="/webgl/lessons/resources/fragment-shader-anim.html"></iframe>
  <div class="webgl_center">v_color is interpolated between v0, v1 and v2</div>
</div>

</p>
<p>Going back to our <a href="webgl-fundamentals.html">first article</a> we drew a triangle in
clip space, no math. We just passed in some clip space coordinates
to a simple vertex shader that looked like this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  // an attribute will receive data from a buffer
  attribute vec4 a_position;

  // all shaders have a main function
  void main() {

    // gl_Position is a special variable a vertex shader
    // is responsible for setting
    gl_Position = a_position;
  }
</code></pre><p>We had a simple fragment shader that draws a constant color</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  // fragment shaders don&#39;t have a default precision so we need
  // to pick one. mediump is a good default
  precision mediump float;

  void main() {
    // gl_FragColor is a special variable a fragment shader
    // is responsible for setting
    gl_FragColor = vec4(1, 0, 0.5, 1); // return reddish-purple
  }
</code></pre><p>So let&#39;s make that draw 2 rectangles in clip space. We&#39;ll pass it this
data with <code class="notranslate" translate="no">X</code>, <code class="notranslate" translate="no">Y</code>, <code class="notranslate" translate="no">Z</code>, and <code class="notranslate" translate="no">W</code> for each vertex.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">var positions = [
  -.8, -.8, 0, 1,  // 1st rect 1st triangle
   .8, -.8, 0, 1,
  -.8, -.2, 0, 1,
  -.8, -.2, 0, 1,  // 1st rect 2nd triangle
   .8, -.8, 0, 1,
   .8, -.2, 0, 1,

  -.8,  .2, 0, 1,  // 2nd rect 1st triangle
   .8,  .2, 0, 1,
  -.8,  .8, 0, 1,
  -.8,  .8, 0, 1,  // 2nd rect 2nd triangle
   .8,  .2, 0, 1,
   .8,  .8, 0, 1,
];
</code></pre><p>Here&#39;s that</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-clipspace-rectangles.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-clipspace-rectangles.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>Let&#39;s add a single varying float. We&#39;ll pass that directly
from the vertex shader to the fragment shader.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  attribute vec4 a_position;
+  attribute float a_brightness;

+  varying float v_brightness;

  void main() {
    gl_Position = a_position;

+    // just pass the brightness on to the fragment shader
+    v_brightness = a_brightness;
  }
</code></pre><p>In the fragment shader we&#39;ll use that varying to set the color</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  precision mediump float;

+  // passed in from the vertex shader and interpolated
+  varying float v_brightness;  

  void main() {
*    gl_FragColor = vec4(v_brightness, 0, 0, 1);  // reds
  }
</code></pre><p>We need to supply data for that varying so we&#39;ll make a buffer and
put in some data. One value per vertex. We&#39;ll set all the brightness
values for vertices on the left to 0 and those on the right to 1.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  // Create a buffer and put 12 brightness values in it
  var brightnessBuffer = gl.createBuffer();

  // Bind it to ARRAY_BUFFER (think of it as ARRAY_BUFFER = brightnessBuffer)
  gl.bindBuffer(gl.ARRAY_BUFFER, brightnessBuffer);

  var brightness = [
    0,  // 1st rect 1st triangle
    1, 
    0, 
    0,  // 1st rect 2nd triangle
    1, 
    1, 

    0,  // 2nd rect 1st triangle
    1, 
    0, 
    0,  // 2nd rect 2nd triangle
    1, 
    1, 
  ];

  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array(brightness), gl.STATIC_DRAW);
</code></pre><p>We also need to look up the location of the <code class="notranslate" translate="no">a_brightness</code> attribute 
at init time</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  // look up where the vertex data needs to go.
  var positionAttributeLocation = gl.getAttribLocation(program, &quot;a_position&quot;);
+  var brightnessAttributeLocation = gl.getAttribLocation(program, &quot;a_brightness&quot;);
</code></pre><p>and setup that attribute at render time</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  // Turn on the attribute
  gl.enableVertexAttribArray(brightnessAttributeLocation);

  // Bind the brightness buffer.
  gl.bindBuffer(gl.ARRAY_BUFFER, brightnessBuffer);

  // Tell the attribute how to get data out of brightnessBuffer (ARRAY_BUFFER)
  var size = 1;          // 1 component per iteration
  var type = gl.FLOAT;   // the data is 32bit floats
  var normalize = false; // don&#39;t normalize the data
  var stride = 0;        // 0 = move forward size * sizeof(type) each iteration to get the next position
  var offset = 0;        // start at the beginning of the buffer
  gl.vertexAttribPointer(
      brightnessAttributeLocation, size, type, normalize, stride, offset);
</code></pre><p>And now when we render we get two rectangles that are black on the left
when <code class="notranslate" translate="no">brightness</code> is 0 and red on the right when <code class="notranslate" translate="no">brightness</code> is 1 and
for the area in between <code class="notranslate" translate="no">brightness</code> is interpolated or (varied) as it
goes across the triangles.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-clipspace-rectangles-with-varying.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-clipspace-rectangles-with-varying.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>So then, from the <a href="webgl-3d-perspective.html">perspective article</a> we know that WebGL takes whatever value we put in <code class="notranslate" translate="no">gl_Position</code> and it divides it by
<code class="notranslate" translate="no">gl_Position.w</code>.</p>
<p>In the vertices above we supplied <code class="notranslate" translate="no">1</code> for <code class="notranslate" translate="no">W</code> but since we know WebGL
will divide by <code class="notranslate" translate="no">W</code> then we should be able do something like this
and get the same result.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">  var mult = 20;
  var positions = [
      -.8,  .8, 0, 1,  // 1st rect 1st triangle
       .8,  .8, 0, 1,
      -.8,  .2, 0, 1,
      -.8,  .2, 0, 1,  // 1st rect 2nd triangle
       .8,  .8, 0, 1,
       .8,  .2, 0, 1,

      -.8       , -.2       , 0,    1,  // 2nd rect 1st triangle
       .8 * mult, -.2 * mult, 0, mult,
      -.8       , -.8       , 0,    1,
      -.8       , -.8       , 0,    1,  // 2nd rect 2nd triangle
       .8 * mult, -.2 * mult, 0, mult,
       .8 * mult, -.8 * mult, 0, mult,
  ];
</code></pre><p>Above you can see that for every point on the right in the second
rectangle we are multiplying <code class="notranslate" translate="no">X</code> and <code class="notranslate" translate="no">Y</code> by <code class="notranslate" translate="no">mult</code> but, we are also
setting <code class="notranslate" translate="no">W</code> to <code class="notranslate" translate="no">mult</code>. Since WebGL will divide by <code class="notranslate" translate="no">W</code> we should get
the exact same result right?</p>
<p>Well here&#39;s that</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-clipspace-rectangles-with-varying-non-1-w.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-clipspace-rectangles-with-varying-non-1-w.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>Note the 2 rectangles are drawn in the same place they were before. This
proves <code class="notranslate" translate="no">X * MULT / MULT(W)</code> is still just <code class="notranslate" translate="no">X</code> and same for <code class="notranslate" translate="no">Y</code>. But, the
colors are different. What&#39;s going on?</p>
<p>It turns out WebGL uses <code class="notranslate" translate="no">W</code> to implement perspective correct
texture mapping or rather to do perspective correct interpolation
of varyings.</p>
<p>In fact to make it easier to see let&#39;s hack the fragment shader to this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">gl_FragColor = vec4(fract(v_brightness * 10.), 0, 0, 1);  // reds
</code></pre><p>multiplying <code class="notranslate" translate="no">v_brightness</code> by 10 will make the value go from 0 to 10. <code class="notranslate" translate="no">fract</code> will
just keep the fractional part so it will go 0 to 1, 0 to 1, 0 to 1, 10 times</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-clipspace-rectangles-with-varying-non-1-w-repeat.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-clipspace-rectangles-with-varying-non-1-w-repeat.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>Now it should be easy to see the perspective.</p>
<p>A linear interpolation from one value to another would be this
formula</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no"> result = (1 - t) * a + t * b
</code></pre><p>Where <code class="notranslate" translate="no">t</code> is a value from 0 to 1 representing some position between <code class="notranslate" translate="no">a</code> and <code class="notranslate" translate="no">b</code>. 0 at <code class="notranslate" translate="no">a</code> and 1 at <code class="notranslate" translate="no">b</code>.</p>
<p>For varyings though WebGL uses this formula</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no"> result = (1 - t) * a / aW + t * b / bW
          -----------------------------
             (1 - t) / aW + t / bW
</code></pre><p>Where <code class="notranslate" translate="no">aW</code> is the <code class="notranslate" translate="no">W</code> that was set on <code class="notranslate" translate="no">gl_Position.w</code> when the varying was
as set to <code class="notranslate" translate="no">a</code> and <code class="notranslate" translate="no">bW</code> is the <code class="notranslate" translate="no">W</code> that was set on <code class="notranslate" translate="no">gl_Position.w</code> when the
varying was set to <code class="notranslate" translate="no">b</code>.</p>
<p>Why is that important? Well here&#39;s a simple textured cube like we ended up with in the <a href="webgl-3d-textures.html">article on textures</a>. I&#39;ve adjusted
the UV coordinates to go from 0 to 1 on each side and it&#39;s using a 4x4 pixel texture.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-perspective-correct-cube.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-perspective-correct-cube.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>Now let&#39;s take that example and change the vertex shader so that
we divide by <code class="notranslate" translate="no">W</code> ourselves. We just need to add 1 line.</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no">attribute vec4 a_position;
attribute vec2 a_texcoord;

uniform mat4 u_matrix;

varying vec2 v_texcoord;

void main() {
  // Multiply the position by the matrix.
  gl_Position = u_matrix * a_position;

+  // Manually divide by W.
+  gl_Position /= gl_Position.w;

  // Pass the texcoord to the fragment shader.
  v_texcoord = a_texcoord;
}
</code></pre><p>Dividing by <code class="notranslate" translate="no">W</code> means <code class="notranslate" translate="no">gl_Position.w</code> will end up being 1. 
<code class="notranslate" translate="no">X</code>, <code class="notranslate" translate="no">Y</code>, and <code class="notranslate" translate="no">Z</code> will come out just like they would if we let
WebGL do the division for us. Well here are the results.</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-non-perspective-correct-cube.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-non-perspective-correct-cube.html" target="_blank">click here to open in a separate window</a>
</div>

</p>
<p>We still get a 3D cube but the textures are getting warped. This 
is because by not passing <code class="notranslate" translate="no">W</code> as it was before WebGL is not able to do
perspective correct texture mapping. Or more correctly, WebGL is not
able to do perspective correct interpolation of varyings.</p>
<p>If you recall <code class="notranslate" translate="no">W</code> was our <code class="notranslate" translate="no">Z</code> value from our <a href="webgl-3d-perspective.html">perspective matrix</a>.
With <code class="notranslate" translate="no">W</code> just being <code class="notranslate" translate="no">1</code> WebGL just ends up doing a linear interpolation.
In fact if you take the equation above</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no"> result = (1 - t) * a / aW + t * b / bW
          -----------------------------
             (1 - t) / aW + t / bW
</code></pre><p>And change all the <code class="notranslate" translate="no">W</code>s to 1s we get</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no"> result = (1 - t) * a / 1 + t * b / 1
          ---------------------------
             (1 - t) / 1 + t / 1
</code></pre><p>Dividing by 1 does nothing so we can simplify to this</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no"> result = (1 - t) * a + t * b
          -------------------
             (1 - t) + t
</code></pre><p><code class="notranslate" translate="no">(1 - t) + t</code> is the same as <code class="notranslate" translate="no">1</code>. For example
if <code class="notranslate" translate="no">t</code> was <code class="notranslate" translate="no">.7</code> we&#39;d get <code class="notranslate" translate="no">(1 - .7) + .7</code> which is <code class="notranslate" translate="no">.3 + .7</code> which is <code class="notranslate" translate="no">1</code>. In other words we can remove the bottom so we&#39;re left with</p>
<pre class="prettyprint notranslate" translate="no"><code class="notranslate" translate="no"> result = (1 - t) * a + t * b
</code></pre><p>Which the same as the linear interpolation equation above.</p>
<p>Hopefully it&#39;s now clear why WebGL uses a 4x4 matrix and 
4 value vectors with <code class="notranslate" translate="no">X</code>, <code class="notranslate" translate="no">Y</code>, <code class="notranslate" translate="no">Z</code>, and <code class="notranslate" translate="no">W</code>. <code class="notranslate" translate="no">X</code> and <code class="notranslate" translate="no">Y</code> divided by <code class="notranslate" translate="no">W</code> get a clipspace coordinate. <code class="notranslate" translate="no">Z</code> divided by <code class="notranslate" translate="no">W</code> also get a clipspace coordinate in Z and <code class="notranslate" translate="no">W</code> is still used during interopation of varyings and
provides the ability to do perspective correct texture mapping.</p>
<div class="webgl_bottombar">
<h3>Mid 1990s Game Consoles</h3>
<p>
As a little piece of trivia the PlayStation 1 and some of the other 
game consoles from the same era didn't do perspective correct texture mapping. Looking at the results above you can now see why
they looked the way they did.
</p>
<div class="webgl_center"><img src="resources/ridge-racer-01.png" style="max-width: 500px;" /></div>
<p></p>
<div class="webgl_center"><img src="resources/ridge-racer-02.png" style="max-width: 500px;" /></div>
</div>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html" selected>English</a>
    <option value="/webgl/lessons/fr/webgl-3d-perspective-correct-texturemapping.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-3d-perspective-correct-texturemapping.html" >日本語</a>
    <option value="/webgl/lessons/ko/webgl-3d-perspective-correct-texturemapping.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-3d-perspective-correct-texturemapping.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-3d-perspective-correct-texturemapping.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-3d-perspective-correct-texturemapping.html" >Русский</a>
    <option value="/webgl/lessons/uk/webgl-3d-perspective-correct-texturemapping.html" >Українська</a>
    <option value="/webgl/lessons/zh_cn/webgl-3d-perspective-correct-texturemapping.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>Fundamentals</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-fundamentals.html">Fundamentals</a></li>
<li><a href="/webgl/lessons/webgl-how-it-works.html">How It Works</a></li>
<li><a href="/webgl/lessons/webgl-shaders-and-glsl.html">Shaders and GLSL</a></li>
<li><a href="/webgl/lessons/resources/webgl-state-diagram.html">WebGL State Diagram</a></li>
        </ul>
  <li>Image Processing</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-image-processing.html">Image Processing</a></li>
<li><a href="/webgl/lessons/webgl-image-processing-continued.html">Image Processing Continued</a></li>
        </ul>
  <li>2D translation, rotation, scale, matrix math</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-2d-translation.html">2D Translation</a></li>
<li><a href="/webgl/lessons/webgl-2d-rotation.html">2D Rotation</a></li>
<li><a href="/webgl/lessons/webgl-2d-scale.html">2D Scale</a></li>
<li><a href="/webgl/lessons/webgl-2d-matrices.html">2D Matrices</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-orthographic.html">Orthographic 3D</a></li>
<li><a href="/webgl/lessons/webgl-3d-perspective.html">3D Perspective</a></li>
<li><a href="/webgl/lessons/webgl-3d-camera.html">3D Cameras</a></li>
        </ul>
  <li>Lighting</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-lighting-directional.html">Directional Lighting</a></li>
<li><a href="/webgl/lessons/webgl-3d-lighting-point.html">Point Lighting</a></li>
<li><a href="/webgl/lessons/webgl-3d-lighting-spot.html">Spot Lighting</a></li>
        </ul>
  <li>Structure and Organization</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-less-code-more-fun.html">Less Code, More Fun</a></li>
<li><a href="/webgl/lessons/webgl-drawing-multiple-things.html">Drawing Multiple Things</a></li>
<li><a href="/webgl/lessons/webgl-scene-graph.html">Scene Graphs</a></li>
        </ul>
  <li>Geometry</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-geometry-lathe.html">Geometry - Lathe</a></li>
<li><a href="/webgl/lessons/webgl-load-obj.html">Loading .obj files</a></li>
<li><a href="/webgl/lessons/webgl-load-obj-w-mtl.html">Loading .obj w .mtl files</a></li>
        </ul>
  <li>Textures</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-3d-textures.html">Textures</a></li>
<li><a href="/webgl/lessons/webgl-data-textures.html">Data Textures</a></li>
<li><a href="/webgl/lessons/webgl-2-textures.html">Using 2 or More Textures</a></li>
<li><a href="/webgl/lessons/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/webgl-3d-perspective-correct-texturemapping.html">Perspective Correct Texture Mapping</a></li>
<li><a href="/webgl/lessons/webgl-planar-projection-mapping.html">Planar and Perspective Projection Mapping</a></li>
        </ul>
  <li>Rendering To A Texture</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-render-to-texture.html">Render to Texture</a></li>
        </ul>
  <li>Shadows</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-shadows.html">Shadows</a></li>
        </ul>
  <li>Techniques</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/webgl-2d-matrix-stack.html">2D - Matrix Stack</a></li>
<li><a href="/webgl/lessons/webgl-sprites.html">Sprites</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-cube-maps.html">Cubemaps</a></li>
<li><a href="/webgl/lessons/webgl-environment-maps.html">Environment maps</a></li>
<li><a href="/webgl/lessons/webgl-skybox.html">Skyboxes</a></li>
<li><a href="/webgl/lessons/webgl-skinning.html">Skinning</a></li>
<li><a href="/webgl/lessons/webgl-fog.html">Fog</a></li>
<li><a href="/webgl/lessons/webgl-picking.html">Picking (clicking on stuff)</a></li>
        </ul>
  <li>Text</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-text-html.html">Text - HTML</a></li>
<li><a href="/webgl/lessons/webgl-text-canvas2d.html">Text - Canvas 2D</a></li>
<li><a href="/webgl/lessons/webgl-text-texture.html">Text - Using a Texture</a></li>
<li><a href="/webgl/lessons/webgl-text-glyphs.html">Text - Using a Glyph Texture</a></li>
        </ul>
  <li>Textures</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-ramp-textures.html">Ramp Textures (Toon Shading)</a></li>
        </ul>
  <li>GPGPU</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-gpgpu.html">GPGPU</a></li>
        </ul>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-smallest-programs.html">Smallest Programs</a></li>
<li><a href="/webgl/lessons/webgl-drawing-without-data.html">Drawing Without Data</a></li>
<li><a href="/webgl/lessons/webgl-shadertoy.html">Shadertoy</a></li>
<li><a href="/webgl/lessons/webgl-pulling-vertices.html">Pulling Vertices</a></li>
        </ul>
  <li>Optimization</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-indexed-vertices.html">Indexed Vertices (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/webgl-instanced-drawing.html">Instanced Drawing</a></li>
        </ul>
  <li>Misc</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-setup-and-installation.html">Setup And Installation</a></li>
<li><a href="/webgl/lessons/webgl-boilerplate.html">Boilerplate</a></li>
<li><a href="/webgl/lessons/webgl-resizing-the-canvas.html">Resizing the Canvas</a></li>
<li><a href="/webgl/lessons/webgl-animation.html">Animation</a></li>
<li><a href="/webgl/lessons/webgl-points-lines-triangles.html">Points, Lines, and Triangles</a></li>
<li><a href="/webgl/lessons/webgl-multiple-views.html">Multiple Views, Multiple Canvases</a></li>
<li><a href="/webgl/lessons/webgl-visualizing-the-camera.html">Visualizing the Camera</a></li>
<li><a href="/webgl/lessons/webgl-and-alpha.html">WebGL and Alpha</a></li>
<li><a href="/webgl/lessons/webgl-2d-vs-3d-library.html">2D vs 3D libraries</a></li>
<li><a href="/webgl/lessons/webgl-anti-patterns.html">Anti-Patterns</a></li>
<li><a href="/webgl/lessons/webgl-matrix-vs-math.html">WebGL Matrices vs Math Matrices</a></li>
<li><a href="/webgl/lessons/webgl-precision-issues.html">Precision Issues</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#screenshot">Taking a screenshot</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#preservedrawingbuffer">Prevent the Canvas Being Cleared</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#tabindex">Get Keyboard Input From a Canvas</a></li>
<li><a href="/webgl/lessons/webgl-tips.html#html-background">Use WebGL as Background in HTML</a></li>
<li><a href="/webgl/lessons/webgl-cross-platform-issues.html">Cross Platform Issues</a></li>
<li><a href="/webgl/lessons/webgl-qna.html">Questions and Answers</a></li>
        </ul>
  <li>Reference</li>
        <ul>
          <li><a href="/webgl/lessons/webgl-attributes.html">Attributes</a></li>
<li><a href="/webgl/lessons/webgl-texture-units.html">Texture Units</a></li>
<li><a href="/webgl/lessons/webgl-framebuffers.html">Framebuffers</a></li>
<li><a href="/webgl/lessons/webgl-readpixels.html">readPixels</a></li>
<li><a href="/webgl/lessons/webgl-references.html">References</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">Helper API Docs</a></li>
  <li><a href="https://twgljs.org">TWGL, A tiny WebGL helper library</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl-fundamentals">github</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        
<div>Questions? <a href="https://stackoverflow.com/questions/tagged/webgl">Ask on stackoverflow</a>.</div>
<div>Issue/Bug? <a href="https://github.com/gfxfundamentals/webgl-fundamentals/issues">Create an issue on github</a>.</div>
<div class="lesson-comment-notes">
   Use <b>&lt;pre&gt;&lt;code&gt;</b>code goes here<b>&lt;/code&gt;&lt;/pre&gt;</b> for code blocks
</div>
  

        <div id="disqus_thread"></div>
        <script>
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL 3D Perspective Correct Texture Mapping';
            var disqus_title = 'WebGL 3D Perspective Correct Texture Mapping';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script>
const settings = {
  contribTemplate: "Thank you <a href=\"${html_url}\"><img src=\"${avatar_url}\"> ${login}</a><br>for <a href=\"https://github.com/${owner}/${repo}/commits?author=${login}\">${contributions} contributions</a>",
  owner: "gfxfundamentals",
  repo: "webgl-fundamentals",
};
</script>
<script src="/contributors.js"></script>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js" type="module"></script>
<script>
</script>


</html>



