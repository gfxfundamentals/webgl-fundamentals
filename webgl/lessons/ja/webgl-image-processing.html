<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/ja/webgl-image-processing.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of Gregg Tavares. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="ja">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="description" content="WebGLで画像の加工処理をする方法" />
<meta name="keywords" content="webgl graphics" />
<meta name="thumbnail" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-image-processing_ja.jpg" />

<meta property="og:title" content="WebGLにおける画像処理" />
<meta property="og:type" content="website" />
<meta property="og:image" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-image-processing_ja.jpg" />
<meta property="og:description" content="WebGLで画像の加工処理をする方法" />
<meta property="og:url" content="https://webglfundamentals.org/webgl/lessons/ja/webgl-image-processing.html" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@greggman" />
<meta name="twitter:creator" content="@greggman" />
<meta name="twitter:domain" content="webglfundamentals.org" />
<meta name="twitter:title" content="WebGLにおける画像処理" />
<meta name="twitter:url" content="https://webglfundamentals.org/webgl/lessons/ja/webgl-image-processing.html" />
<meta name="twitter:description" content="WebGLで画像の加工処理をする方法" />
<meta name="twitter:image:src" content="https://webglfundamentals.org/webgl/lessons/screenshots/webgl-image-processing_ja.jpg" />

<script type="application/ld+json">
{
  "@context":"https://schema.org",
  "@graph":[
    {
      "@type":"WebSite",
      "@id":"https://webglfundamentals.org/#website",
      "url":"https://webglfundamentals.org/",
      "name":"WebglFundamentals"
    },
    {
      "@type":"ImageObject",
      "@id":"https://webglfundamentals.org/webgl/lessons/ja/webgl-image-processing.html#primaryimage",
      "url":"https://webglfundamentals.org/webgl/lessons/screenshots/webgl-image-processing_ja.jpg",
      "width":1200,
      "height":630
    },
    {
      "@type":"WebPage",
      "@id":"https://webglfundamentals.org/webgl/lessons/ja/webgl-image-processing.html#webpage",
      "url":"https://webglfundamentals.org/webgl/lessons/ja/webgl-image-processing.html",
      "inLanguage":"ja",
      "name":"WebGLにおける画像処理",
      "keywords":"webgl graphics programming",
      "isPartOf":{
        "@id":"https://webglfundamentals.org/#website"
      },
      "primaryImageOfPage":{
        "@id":"https://webglfundamentals.org/webgl/lessons/ja/webgl-image-processing.html#primaryimage"
      }
    }
  ]
}
</script>


<title>WebGLにおける画像処理</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css" type="text/css" />



</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-image-processing.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-image-processing.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-image-processing.html" selected>日本語</a>
    <option value="/webgl/lessons/ko/webgl-image-processing.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-image-processing.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-image-processing.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-image-processing.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-image-processing.html" >简体中文</a>
</select>


    <a href="#toc">目次</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/ja/">WebGLFundamentals.org</a></h1>
<style>
#forkongithub a {
    background: #000;
    color: #fff;
    text-decoration: none;
    font-family: arial,sans-serif;
    text-align: center;
    font-weight: bold;
    padding: 5px 40px;
    font-size: 0.9rem;
    line-height: 2rem;
    position: relative;
    transition: 0.5s;
    display: block;
    width: 300px;
    position: absolute;
    top: 0;
    right: 0;
    transform: translateX(150px) rotate(45deg) translate(10px,70px);
    box-shadow: 4px 4px 10px rgba(0,0,0,0.8);
    pointer-events: auto;
}
#forkongithub a:hover {
    background: #c11;
    color: #fff;
}
#forkongithub a::before,#forkongithub a::after {
    content: "";
    width: 100%;
    display: block;
    position: absolute;
    top: 1px;
    left: 0;
    height: 1px;
    background: #fff;
}
#forkongithub a::after {
    bottom: 1px;
    top: auto;
}

#forkongithub{
    z-index: 9999;
    /* needed for firefox */
    overflow: hidden;
    width: 300px;
    height: 300px;
    position: absolute;
    right: 0;
    top: 0;
    pointer-events: none;
}
#forkongithub svg{
  width: 1em;
  height: 1em;
  vertical-align: middle;
}
@media (max-width: 900px) {
    #forkongithub a{
        line-height: 1.2rem;
    }
}
@media (max-width: 700px) {
  #forkongithub {
    display: none;
  }
}
@media (max-width: 410px) {
    #forkongithub a{
        font-size: 0.7rem;
        transform: translateX(150px) rotate(45deg) translate(20px,40px);
    }
}

</style>
<div id="forkongithub"><a href="https://github.com/gfxfundamentals/webgl-fundamentals">Fix, Fork, Contribute <?xml version="1.0" encoding="UTF-8" standalone="no"?>
<!DOCTYPE svg PUBLIC "-//W3C//DTD SVG 1.1//EN" "http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd">
<svg width="100%" height="100%" viewBox="0 0 136 133" version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" xml:space="preserve" xmlns:serif="http://www.serif.com/" style="fill-rule:evenodd;clip-rule:evenodd;stroke-linejoin:round;stroke-miterlimit:2;">
    <g transform="matrix(3.92891,0,0,3.92891,67.867,129.125)">
        <path d="M0,-31.904C-8.995,-31.904 -16.288,-24.611 -16.288,-15.614C-16.288,-8.417 -11.621,-2.312 -5.148,-0.157C-4.333,-0.008 -4.036,-0.511 -4.036,-0.943C-4.036,-1.329 -4.05,-2.354 -4.058,-3.713C-8.589,-2.729 -9.545,-5.897 -9.545,-5.897C-10.286,-7.779 -11.354,-8.28 -11.354,-8.28C-12.833,-9.29 -11.242,-9.27 -11.242,-9.27C-9.607,-9.155 -8.747,-7.591 -8.747,-7.591C-7.294,-5.102 -4.934,-5.821 -4.006,-6.238C-3.858,-7.29 -3.438,-8.008 -2.972,-8.415C-6.589,-8.826 -10.392,-10.224 -10.392,-16.466C-10.392,-18.244 -9.757,-19.698 -8.715,-20.837C-8.883,-21.249 -9.442,-22.905 -8.556,-25.148C-8.556,-25.148 -7.188,-25.586 -4.076,-23.478C-2.777,-23.84 -1.383,-24.02 0.002,-24.026C1.385,-24.02 2.779,-23.84 4.08,-23.478C7.19,-25.586 8.555,-25.148 8.555,-25.148C9.444,-22.905 8.885,-21.249 8.717,-20.837C9.761,-19.698 10.392,-18.244 10.392,-16.466C10.392,-10.208 6.583,-8.831 2.954,-8.428C3.539,-7.925 4.06,-6.931 4.06,-5.411C4.06,-3.234 4.04,-1.477 4.04,-0.943C4.04,-0.507 4.333,0 5.16,-0.159C11.628,-2.318 16.291,-8.419 16.291,-15.614C16.291,-24.611 8.997,-31.904 0,-31.904" style="fill:white;"/>
    </g>
</svg>
</a></div>

</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGLにおける画像処理</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>WebGLでは、画像の加工処理は簡単である。どれくらい簡単か？まずは続きを読んで頂きたい。
<!--more-->
この記事は、「<a href="webgl-fundamentals.html">WebGLの基礎</a>」の続きである。
あらかじめ「<a href="webgl-fundamentals.html">WebGLの基礎</a>」を読むことをお勧めする。</p>
<p>WebGLで画像を描くには「テクスチャー」を使う必要がある。
WebGLでは、レンダリングする際に「ピクセル」ではなく「クリッピング空間座標」を使用したが、
これと同じように、テクスチャを描く際には「テクスチャ座標」を使用する。
テクスチャ座標は、テクスチャの大きさに関わらず0.0から1.0の数値で指定する。</p>
<h2 id="-">テクスチャーとテクスチャ座標</h2>
<p>長方形を１つだけ描く(WebGLが描くのは、正確には「２つの三角形」であるが)状況を想定すると、
WebGLが描画に必要とするのは「テクスチャーのどの部分が、長方形のどの部分に対応するのか」
という情報である。
頂点シェーダーからフラグメントシェーダーへこの情報を渡す際には、
「varying」と呼ばれる特殊な変数を使用する。varyとは英語で「可変」といった意味だ。
頂点シェーダで提供されるvaryingの値は、各ピクセルをフラグメントシェーダーで描く段階で
WebGLによって「補間」される。</p>
<p>では、テクスチャーを利用する機能を、<a href="webgl-fundamentals.html">以前の記事</a>で使った
コードの最終版を元にして実装してみよう。</p>
<p>まず「テクスチャ座標」を受け取るためのアトリビュートと、
それを「頂点シェーダーからフラグメントシェーダーに渡す」仕組みを追加する必要がある。</p>
<pre class="prettyprint"><code>attribute vec2 a_texCoord;
...
varying vec2 v_texCoord;

void main() {
   ...
   // texCoord(テクスチャ座標)をフラグメントシェーダーに渡す。
   // GPUが各頂点間の補間を行う際、同時にこのtexCoordの値も補間される。
   v_texCoord = a_texCoord;
}
</code></pre><p>次は、フラグメントシェーダーを変更する。
「描くべき色を、テクスチャを参照して判断する」ように変更する。</p>
<pre class="prettyprint"><code>&lt;script id=&quot;2d-fragment-shader&quot; type=&quot;x-shader/x-fragment&quot;&gt;
precision mediump float;

// これが今回使うテクスチャ
uniform sampler2D u_image;

// 頂点シェーダーから渡された「テクスチャ座標」の値。
varying vec2 v_texCoord;

void main() {
   // テクスチャの色を参照する。
   gl_FragColor = texture2D(u_image, v_texCoord);
}
&lt;/script&gt;
</code></pre><h2 id="-">画像からテクスチャーを生成する</h2>
<p>２つのシェーダーが用意できたら、次は「画像をロード」して
「テクスチャーを生成」して「テクスチャーへ画像をコピー」する必要がある。
ブラウザーでは画像のロードは非同期に行われるので、画像のロード完了を待つための
ちょっとした仕組みが必要となる。
画像のロードが完了したタイミングで、描画を行うようにする。</p>
<pre class="prettyprint"><code>function main() {
  var image = new Image();
  image.src = &quot;http://someimage/on/our/server&quot;;  // 同じドメインじゃないとダメ！
  image.onload = function() {
    render(image);
  }
}

function render(image) {
  ...
  // 前に書いたコード全部をここに書く……
  ...
  // 「テクスチャ座標」データの送り先(アトリビュート)のロケーションを取得する。
  var texCoordLocation = gl.getAttribLocation(program, &quot;a_texCoord&quot;);

  // 長方形の各頂点とテクスチャ座標の対応付けを定義する
  var texCoordBuffer = gl.createBuffer();
  gl.bindBuffer(gl.ARRAY_BUFFER, texCoordBuffer);
  gl.bufferData(gl.ARRAY_BUFFER, new Float32Array([
      0.0,  0.0,
      1.0,  0.0,
      0.0,  1.0,
      0.0,  1.0,
      1.0,  0.0,
      1.0,  1.0]), gl.STATIC_DRAW);
  gl.enableVertexAttribArray(texCoordLocation);
  gl.vertexAttribPointer(texCoordLocation, 2, gl.FLOAT, false, 0, 0);

  // 「テクスチャー」を生成する
  var texture = gl.createTexture();
  gl.bindTexture(gl.TEXTURE_2D, texture);

  // どんなサイズの画像でもレンダリングできるようにパラメータを設定する
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
  gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);

  // テクスチャーに画像のデータをアップロードする
  gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, image);
  ...
}
</code></pre><p>以上で、WebGLで画像がレンダリングできた。
<strong>注意</strong>：WebGLの画像ロードにはセキュリティ上の制約があるため、
ローカルでこのサンプルを試す場合は何らかのWebサーバーを動かす必要がある。
この設定は<a href="webgl-setup-and-installation.html">数分の作業</a>で終わる。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-image.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-image.html" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<p>おもしろみがない？では、画像処理をやってみよう。例えば赤と青を入れ替えてみるのはどうだろうか。</p>
<pre class="prettyprint"><code>...
gl_FragColor = texture2D(u_image, v_texCoord).bgra;
...
</code></pre><p>これで赤と青を入れ替えることができた。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-image-red2blue.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-image-red2blue.html" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<h2 id="-">他のピクセルの参照</h2>
<p>やりたい画像処理が、いま描いているピクセルだけで完結せず「ほかのピクセル」の情報も
必要とする場合はどうすればよいだろうか？
WebGLはテクスチャを参照する際、0.0から1.0の値を取る「テクスチャ座標」を使用しているので、
元画像で「１ピクセル」移動するためにテクスチャ座標の数値をどれだけ移動すれば良いかは、
<code>onePixel = 1.0 / textureSize</code>といった計算で求めることができる。</p>
<p>これは「左右１ピクセルを参照してその平均の色で描く」というフラグメントシェーダーである。</p>
<pre class="prettyprint"><code>&lt;script id=&quot;2d-fragment-shader&quot; type=&quot;x-shader/x-fragment&quot;&gt;
precision mediump float;

// 今回使うテクスチャ
uniform sampler2D u_image;
uniform vec2 u_textureSize;

// 頂点シェーダーから渡された「テクスチャ座標」の値。
varying vec2 v_texCoord;

void main() {
   // 「１ピクセル」に相当する、テクスチャ座標での大きさを求める
   vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;

   // 左のピクセル、現在のピクセル、右のピクセルの色の平均値を求める
   gl_FragColor = (
       texture2D(u_image, v_texCoord) +
       texture2D(u_image, v_texCoord + vec2(onePixel.x, 0.0)) +
       texture2D(u_image, v_texCoord + vec2(-onePixel.x, 0.0))) / 3.0;
}
&lt;/script&gt;
</code></pre><p>そしてJavaScriptからは、テクスチャサイズの情報を渡す。</p>
<pre class="prettyprint"><code>...

var textureSizeLocation = gl.getUniformLocation(program, &quot;u_textureSize&quot;);

...

// 画像のサイズをセットする
gl.uniform2f(textureSizeLocation, image.width, image.height);

...
</code></pre><p>これで「ぼかし」が表現できた。上の画像と比べてみよう。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-image-blend.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-image-blend.html" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<h2 id="-">畳み込み行列</h2>
<p>さて、「ほかのピクセル」を参照する方法がわかったので、今度は
「畳み込み行列(convolution kernel)」を使って、もっと汎用的に画像処理をやってみよう。
ここでは、3x3の行列(カーネル)を使うことにする。</p>
<p>「畳み込み行列」とは、ピクセルを描画する際に「縦横斜めに隣り合った周辺8ピクセルを参照」して、
「それぞれの値をそれぞれ何倍するか」を「3x3の行列で指定する」仕組みである。
そして得られた値をすべて足した結果を、「ウェイト(カーネルの全要素の値の合計)」と
「1.0」を比較して「より大きい方」で割る。
「ぼかし」の際に行なった「平均値を求める」仕組みの拡張と考えればよいだろう。</p>
<p>「畳み込み行列」について、ここではこれ以上の説明はしないが、興味があれば
<a href="https://docs.gimp.org/2.10/en/gimp-filter-convolution-matrix.html">わかりやすい記事がある</a>
(<a href="https://docs.gimp.org/2.10/ja/gimp-filter-convolution-matrix.html">日本語版</a>)ので、参考にするとよいだろう。
また、<a href="http://www.codeproject.com/KB/graphics/ImageConvolution.aspx">この記事</a>では
「畳み込み行列」をC++で実装したコードを見ることができる。</p>
<p>フラグメントシェーダーで「畳み込み行列」を実装すると、このようになる。</p>
<pre class="prettyprint"><code>&lt;script id=&quot;2d-fragment-shader&quot; type=&quot;x-shader/x-fragment&quot;&gt;
precision mediump float;

// 今回使うテクスチャ
uniform sampler2D u_image;
uniform vec2 u_textureSize;
uniform float u_kernel[9];
uniform float u_kernelWeight;

// 頂点シェーダーから渡された「テクスチャ座標」の値。
varying vec2 v_texCoord;

void main() {
   vec2 onePixel = vec2(1.0, 1.0) / u_textureSize;
   vec4 colorSum =
     texture2D(u_image, v_texCoord + onePixel * vec2(-1, -1)) * u_kernel[0] +
     texture2D(u_image, v_texCoord + onePixel * vec2( 0, -1)) * u_kernel[1] +
     texture2D(u_image, v_texCoord + onePixel * vec2( 1, -1)) * u_kernel[2] +
     texture2D(u_image, v_texCoord + onePixel * vec2(-1,  0)) * u_kernel[3] +
     texture2D(u_image, v_texCoord + onePixel * vec2( 0,  0)) * u_kernel[4] +
     texture2D(u_image, v_texCoord + onePixel * vec2( 1,  0)) * u_kernel[5] +
     texture2D(u_image, v_texCoord + onePixel * vec2(-1,  1)) * u_kernel[6] +
     texture2D(u_image, v_texCoord + onePixel * vec2( 0,  1)) * u_kernel[7] +
     texture2D(u_image, v_texCoord + onePixel * vec2( 1,  1)) * u_kernel[8] ;

   // 計算の合計値のRGB値(赤緑青の色情報)の部分を「ウェイト」で割る。
   // 透明度の部分は1.0とする
   gl_FragColor = vec4((colorSum / u_kernelWeight).rgb, 1.0);
}
&lt;/script&gt;
</code></pre><p>JavaScript側からは「畳み込み行列」とその「ウェイト」の情報をシェーダーに送る。</p>
<pre class="prettyprint"><code> function computeKernelWeight(kernel) {
   var weight = kernel.reduce(function(prev, curr) {
       return prev + curr;
   });
   return weight &lt;= 0 ? 1 : weight;
 }

 ...
 var kernelLocation = gl.getUniformLocation(program, &quot;u_kernel[0]&quot;);
 var kernelWeightLocation = gl.getUniformLocation(program, &quot;u_kernelWeight&quot;);
 ...
 var edgeDetectKernel = [
     -1, -1, -1,
     -1,  8, -1,
     -1, -1, -1
 ];
 gl.uniform1fv(kernelLocation, edgeDetectKernel);
 gl.uniform1f(kernelWeightLocation, computeKernelWeight(edgeDetectKernel));
 ...
</code></pre><p>これで、完成……。下の例では、ドロップリストで別のカーネルも試せるようにした。</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-2d-image-3x3-convolution.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-2d-image-3x3-convolution.html" target="_blank">クリックして別のウインドウを開く</a>
</div>

</p>
<p>以上、WebGLでの画像処理がどれほど簡単か、おわかりいただけたと思う。</p>
<p>次回の講義では「<a href="webgl-image-processing-continued.html">画像に２つ以上のエフェクトをかける方法</a>」
について説明しよう。</p>
<div class="webgl_bottombar">
<h3>サンプルコードでは<code>u_image</code>に値をセットしていないよ。どうして動くの？</h3>
<p>
シェーダーにおいては「uniformのデフォルト値は0」という決まりがあるため、
今回のサンプルではu_imageは「テクスチャユニット0を使う」という意味になる。
また「アクティブテクスチャのデフォルトはテクスチャユニット0」という決まりがあるため、
JavaScript側でbindTextureが呼ばれたタイミングでテクスチャーは
「テクスチャユニット0に自動的にバインド」される。
このため、明示的にu_imageに値をセットしなくても問題なく動作する。
</p>
<p>
WebGLには「テクスチャユニットの配列」がある。
シェーダー中の各「uniformのsampler変数」がそれぞれ「何番のテクスチャユニットを参照するか」
を指定するためには、まず「uniformのsampler変数」のロケーションを得て、それに対して
「目的のテクスチャユニットのインデックス」を指定する、という手順を使う。
</p>
<p>
例えば、実際のコードは次のようになる。
</p>
<pre class="prettyprint showlinemods">
var textureUnitIndex = 6; // テクスチャユニット6を使う。
var u_imageLoc = gl.getUniformLocation(
    program, "u_image");
gl.uniform1i(u_imageLoc, textureUnitIndex);
</pre>
<p>
別のユニットのテクスチャを使いたい場合は、<code>gl.activeTexture</code>を呼び、
そのユニットのテクスチャをバインドする。例は以下のとおり。
</p>
<pre class="prettyprint showlinemods">
// テクスチャ「someTexture」を、テクスチャユニット6にバインドする。
gl.activeTexture(gl.TEXTURE6);
gl.bindTexture(gl.TEXTURE_2D, someTexture);
</pre>
<p>
こんな書き方もできる。
</p>
<pre class="prettyprint showlinemods">
var textureUnitIndex = 6; // テクスチャユニット6を使う。
// テクスチャ「someTexture」を、テクスチャユニット6にバインドする。
gl.activeTexture(gl.TEXTURE0 + textureUnitIndex);
gl.bindTexture(gl.TEXTURE_2D, someTexture);
</pre>
<p>
すべてのWebGL実装は最低8個のテクスチャユニットをサポートすることになっている。
仕様上サポートされるのは、フラグメントシェーダーでは最低8個、頂点シェーダーでは最低0個である。
8つより多くのテクスチャユニットを使いたい場合は、あらかじめ
<code>gl.getParameter(gl.MAX_TEXTURE_IMAGE_UNITS)</code>を呼んで利用可能な数を確認するべきである。
頂点シェーダーでテクスチャを扱いたい場合は
<code>gl.getParameter(gl.MAX_VERTEX_TEXTURE_IMAGE_UNITS)</code>を呼んで利用可能な数を確認する。
実際のWebGLの実装では、その99%が、頂点シェーダにおいて最低4つのテクスチャユニットをサポートしている。
</p>
</div>

<div class="webgl_bottombar">
<h3>GLSLコードでa_, u_, v_とかで始まる変数があるけどこれは何？</h3>
<p>
これは私が採用している命名規則の話で、文法上必要な規則ではない。
そういった名前にしておくとその変数がどこから来たのか見やすいので、慣習上、私はそうしている。
こうしておけば、「a_で始まる変数はアトリビュートでバッファーから持ってきたデータ」、
「u_はシェーダー共通のユニフォーム変数」、
「v_はvarying変数で頂点シェーダーからフラグメントシェーダーに送られたもので、
描画時に頂点間で補間されている」、といったことが一目でわかる。
各変数の意味や仕組みについては「<a href="webgl-how-it-works.html">WebGLの仕組み</a>」
の講義で説明しているので参考にするとよいだろう。
</p>
</div>


    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-image-processing.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-image-processing.html" >Français</a>
    <option value="/webgl/lessons/ja/webgl-image-processing.html" selected>日本語</a>
    <option value="/webgl/lessons/ko/webgl-image-processing.html" >한국어</a>
    <option value="/webgl/lessons/pl/webgl-image-processing.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-image-processing.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-image-processing.html" >Русский</a>
    <option value="/webgl/lessons/zh_cn/webgl-image-processing.html" >简体中文</a>
</select>


        <div id="toc">
          <ul>  <li>基本</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-fundamentals.html">基本</a></li>
<li><a href="/webgl/lessons/ja/webgl-how-it-works.html">WebGLの仕組み</a></li>
<li><a href="/webgl/lessons/ja/webgl-shaders-and-glsl.html">WebGLのシェーダーとGLSL</a></li>
        </ul>
  <li>画像処理</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-image-processing.html">WebGLにおける画像処理</a></li>
<li><a href="/webgl/lessons/ja/webgl-image-processing-continued.html">WebGLにおける画像処理。続き</a></li>
        </ul>
  <li>2Dでの移動、回転、拡大縮小、行列計算</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-2d-translation.html">二次元での移動</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-rotation.html">二次元での回転</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-scale.html">二次元での拡大縮小</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-matrices.html">二次元での行列数学</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-orthographic.html">三次元の正投影</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-perspective.html">三次元透視投影</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-camera.html">三次元のカメラ</a></li>
        </ul>
  <li>Lighting</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-lighting-directional.html">三次元指向性光源</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-lighting-point.html">三次元点光源</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-lighting-spot.html">Spot Lighting</a></li>
        </ul>
  <li>Structure and Organization</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-less-code-more-fun.html">Less Code, More Fun</a></li>
<li><a href="/webgl/lessons/ja/webgl-drawing-multiple-things.html">Drawing Multiple Things</a></li>
<li><a href="/webgl/lessons/ja/webgl-scene-graph.html">Scene Graphs</a></li>
        </ul>
  <li>Geometry</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-geometry-lathe.html">Geometry - Lathe</a></li>
        </ul>
  <li>テクスチャ</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-3d-textures.html">Textures</a></li>
<li><a href="/webgl/lessons/ja/webgl-data-textures.html">データテクスチャ</a></li>
<li><a href="/webgl/lessons/ja/webgl-2-textures.html">複数のテクスチャを使う</a></li>
<li><a href="/webgl/lessons/ja/webgl-cors-permission.html">Cross Origin Images</a></li>
<li><a href="/webgl/lessons/ja/webgl-3d-perspective-correct-texturemapping.html">Perspective Correct Texture Mapping</a></li>
<li><a href="/webgl/lessons/ja/webgl-planar-projection-mapping.html">Planar and Perspective Projection Mapping</a></li>
        </ul>
  <li>Rendering To A Texture</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-render-to-texture.html">Render to Texture</a></li>
        </ul>
  <li>Shadows</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-shadows.html">Shadows</a></li>
        </ul>
  <li>Techniques</li>
        <ul>
            <li>2D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-2d-drawimage.html">2D - DrawImage</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-matrix-stack.html">2D - Matrix Stack</a></li>
        </ul>
  <li>3D</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-cube-maps.html">Cubemaps</a></li>
<li><a href="/webgl/lessons/ja/webgl-environment-maps.html">Environment maps</a></li>
<li><a href="/webgl/lessons/ja/webgl-skybox.html">Skyboxes</a></li>
<li><a href="/webgl/lessons/ja/webgl-skinning.html">Skinning</a></li>
<li><a href="/webgl/lessons/ja/webgl-fog.html">Fog</a></li>
        </ul>
  <li>Text</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-text-html.html">Text - HTML</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-canvas2d.html">Text - Canvas 2D</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-texture.html">Text - Using a Texture</a></li>
<li><a href="/webgl/lessons/ja/webgl-text-glyphs.html">Text - Using a Glyph Texture</a></li>
        </ul>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-smallest-programs.html">Smallest Programs</a></li>
<li><a href="/webgl/lessons/ja/webgl-drawing-without-data.html">Drawing Without Data</a></li>
<li><a href="/webgl/lessons/ja/webgl-pulling-vertices.html">Pulling Vertices</a></li>
        </ul>
  <li>その他のトピック</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-setup-and-installation.html">WebGLの開発環境</a></li>
<li><a href="/webgl/lessons/ja/webgl-boilerplate.html">WebGLのひな型コード</a></li>
<li><a href="/webgl/lessons/ja/webgl-indexed-vertices.html">Indexed Vertices (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ja/webgl-resizing-the-canvas.html">WebGLとcanvasのリサイズ</a></li>
<li><a href="/webgl/lessons/ja/webgl-animation.html">アニメーション</a></li>
<li><a href="/webgl/lessons/ja/webgl-points-lines-triangles.html">Points, Lines, and Triangles</a></li>
<li><a href="/webgl/lessons/ja/webgl-indexed-vertices.html">Indexed Vertices (gl.drawElements)</a></li>
<li><a href="/webgl/lessons/ja/webgl-instanced-drawing.html">Instanced Drawing</a></li>
<li><a href="/webgl/lessons/ja/webgl-multiple-views.html">Multiple Views, Multiple Canvases</a></li>
<li><a href="/webgl/lessons/ja/webgl-visualizing-the-camera.html">Visualizing the Camera</a></li>
<li><a href="/webgl/lessons/ja/webgl-and-alpha.html">WebGL and Alpha</a></li>
<li><a href="/webgl/lessons/ja/webgl-2d-vs-3d-library.html">2D vs 3D libraries</a></li>
<li><a href="/webgl/lessons/ja/webgl-anti-patterns.html">Anti-Patterns</a></li>
<li><a href="/webgl/lessons/ja/webgl-matrix-vs-math.html">WebGL Matrices vs Math Matrices</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#screenshot">Taking a screenshot</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#preservedrawingbuffer">Prevent the Canvas Being Cleared</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#tabindex">Get Keyboard Input From a Canvas</a></li>
<li><a href="/webgl/lessons/ja/webgl-tips.html#html-background">Use WebGL as Background in HTML</a></li>
        </ul>
  <li>Reference</li>
        <ul>
          <li><a href="/webgl/lessons/ja/webgl-attributes.html">Attributes</a></li>
<li><a href="/webgl/lessons/ja/webgl-texture-units.html">Texture Units</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">Helper API Docs(英語)</a></li>
  <li><a href="http://twgljs.org">TWGL, A tiny WebGL helper library</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl-fundamentals">github</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        <div>質問? <a href="http://stackoverflow.com/questions/tagged/webgl">stackoverflowで質問(英語)</a>.</div>
        <div>問題点/バグ? <a href="http://github.com/gfxfundamentals/webgl-fundamentals/issues">githubでissueを作成</a>.</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGLにおける画像処理';
            var disqus_title = 'WebGLにおける画像処理';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js"></script>
<script src="//cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59804936-1', 'auto');
  ga('send', 'pageview');

</script>


</html>



