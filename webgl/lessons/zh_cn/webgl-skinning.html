<!DOCTYPE html>
<!-- this file is auto-generated from webgl/lessons/zh_cn/webgl-skinning.md. Do not edited directly -->
<!--
Copyright 2012, Gregg Tavares.
All rights reserved.

Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are
met:

*   Redistributions of source code must retain the above copyright
    notice, this list of conditions and the following disclaimer.

*   Redistributions in binary form must reproduce the above
    copyright notice, this list of conditions and the following disclaimer
    in the documentation and/or other materials provided with the
    distribution.

*   Neither the name of Gregg Tavares. nor the names of his
    contributors may be used to endorse or promote products derived from
    this software without specific prior written permission.

THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS
"AS IS" AND ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT
LIMITED TO, THE IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR
A PARTICULAR PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT
OWNER OR CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL,
SPECIAL, EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT
LIMITED TO, PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE,
DATA, OR PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY
THEORY OF LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT
(INCLUDING NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE
OF THIS SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.
-->
<html lang="zh-cn">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">
<meta property="og:title" content="WebGL è’™çš®" />
<meta property="og:type" content="website" />
<meta property="og:image" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />
<meta property="og:description" content="åœ¨WebGLä¸­å¦‚ä½•è’™çš®ç½‘æ ¼" />
<meta property="og:url" content="http://webglfundamentals.org/webgl/lessons/zh_cn/webgl-skinning.html" />

<meta name="twitter:card" content="summary_large_image" />
<meta name="twitter:site" content="@greggman" />
<meta name="twitter:creator" content="@greggman" />
<meta name="twitter:domain" content="webglfundamentals.org" />
<meta name="twitter:title" content="WebGL è’™çš®" />
<meta name="twitter:url" content="http://webglfundamentals.org/webgl/lessons/zh_cn/webgl-skinning.html" />
<meta name="twitter:description" content="åœ¨WebGLä¸­å¦‚ä½•è’™çš®ç½‘æ ¼" />
<meta name="twitter:image:src" content="http://webglfundamentals.org/webgl/lessons/resources/webglfundamentals.jpg" />


<title>WebGL è’™çš®</title>
<link href="/webgl/lessons/resources/webglfundamentals-icon.png" rel="shortcut icon" type="image/png">
<link rel="stylesheet" href="/webgl/lessons/resources/lesson.css" type="text/css" />
</head>
<body>
<div class="webgl_navbar">
  <div>
    <select class="language">
    <option value="/webgl/lessons/webgl-skinning.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-skinning.html" >FranÃ§ais</a>
    <option value="/webgl/lessons/ja/webgl-skinning.html" >æ—¥æœ¬èª</a>
    <option value="/webgl/lessons/ko/webgl-skinning.html" >í•œêµ­ì–´</a>
    <option value="/webgl/lessons/pl/webgl-skinning.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-skinning.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-skinning.html" >Ğ ÑƒÑÑĞºĞ¸Ğ¹</a>
    <option value="/webgl/lessons/zh_cn/webgl-skinning.html" selected>ç®€ä½“ä¸­æ–‡</a>
</select>


    <a href="#toc">ç›®å½•</a>
  </div>
</div>
<div class="webgl_header">
  <h1><a href="/webgl/lessons/zh_cn/">WebGLFundamentals.org</a></h1>
</div>


<div class="container">
  <div class="lesson-title">
    <h1>WebGL è’™çš®</h1>
  </div>
  <div class="lesson">
    <div class="lesson-main">
      <p>å›¾å½¢å­¦ä¸­çš„è’™çš®æ˜¯æ ¹æ®å¤šçŸ©é˜µçš„åŠ æƒå½±å“æ¥ç§»åŠ¨ä¸€ç»„é¡¶ç‚¹ã€‚è¿™å¾ˆæŠ½è±¡ã€‚</p>
<p>å®ƒè¢«ç§°ä¸º<em>è’™çš®</em>å› ä¸ºé€šå¸¸ä½¿3Dè§’è‰²æ‹¥æœ‰ç”±éª¨éª¼â€œboneâ€ç»„æˆçš„éª¨æ¶â€œskeletonâ€ï¼Œåœ¨è¿™é‡Œéª¨éª¼â€œboneâ€æ˜¯çŸ©é˜µçš„å¦ä¸€ç§è¡¨è¿°æ–¹å¼ï¼Œå¹¶å¯¹<strong>æ¯ä¸ªé¡¶ç‚¹</strong>è®¾ç½®æ¯ä¸ªéª¨éª¼å¯¹è¯¥é¡¶ç‚¹çš„å½±å“ã€‚</p>
<p>ä¸¾ä¸ªä¾‹å­ä¸€ä¸ªè§’è‰²æ‰‹éƒ¨çš„éª¨éª¼å¯¹äºé è¿‘æ‰‹çš„é¡¶ç‚¹çš„å½±å“å‡ ä¹æ˜¯100%ï¼Œè„šéƒ¨çš„éª¨éª¼å¯¹äºè¿™äº›é¡¶ç‚¹åˆ™ä¸ä¼šæœ‰å½±å“ã€‚æ‰‹è…•é™„è¿‘çš„é¡¶ç‚¹ä¼šå—æ‰‹éª¨ä¸€äº›å½±å“è¿˜ä¼šå—è‡‚éª¨ä¸€äº›å½±å“ã€‚</p>
<p>åŸºæœ¬ä½ éœ€è¦éª¨éª¼(è¿™åªæ˜¯çŸ©é˜µå±‚çº§çš„ä¸€ç§å¥‡å¦™æè¿°æ–¹æ³•)å’Œæƒé‡ã€‚æƒé‡æ˜¯æ¯ä¸ªé¡¶ç‚¹ä»0åˆ°1çš„å€¼è¡¨ç¤ºæŸä¸€éª¨éª¼çŸ©é˜µå¯¹æ­¤é¡¶ç‚¹ä½ç½®çš„å½±å“ç¨‹åº¦ã€‚è‡³äºæ•°æ®ï¼Œæƒé‡æœ‰ç‚¹åƒé¡¶ç‚¹é¢œè‰²ã€‚æ¯ä¸ªé¡¶ç‚¹æœ‰ä¸€ç»„æƒé‡ã€‚æ¢å¥è¯è¯´æƒé‡æ”¾åœ¨ç¼“å†²ä¸­é€šè¿‡å±æ€§æä¾›ã€‚</p>
<p>é€šå¸¸ä½ é™åˆ¶æ¯ä¸ªé¡¶ç‚¹çš„ä¸€éƒ¨åˆ†æƒé‡æ•°é‡ï¼Œå› ä¸ºå¦åˆ™ä¼šæœ‰å¤ªå¤šçš„æ•°æ®ã€‚ä¸€ä¸ªè§’è‰²å¯æ‹¥æœ‰ä½äºä»»ä½•åœ°æ–¹çš„15ä¸ªéª¨éª¼(VR æˆ˜å£«1)åˆ°150-300ä¸ªéª¨éª¼(è®¸å¤šç°ä»£æ¸¸æˆ)ã€‚
å¦‚æœä½ æœ‰300ä¸ªéª¨éª¼ï¼Œé‚£ä¹ˆæ¯ä¸ªé¡¶ç‚¹éœ€è¦300ä¸ªæƒé‡å¯¹åº”300ä¸ªéª¨éª¼ã€‚å¦‚æœä½ æœ‰10000ä¸ªé¡¶ç‚¹å°±ä¼šéœ€è¦3ç™¾ä¸‡ä¸ªæƒé‡ã€‚</p>
<p>æ‰€ä»¥ï¼Œå¤§å¤šæ•°å®æ—¶è’™çš®ç³»ç»Ÿé™åˆ¶æ¯ä¸ªé¡¶ç‚¹~4ä¸ªæƒé‡ã€‚é€šå¸¸è¿™æ˜¯åœ¨å¯¼å‡ºå™¨ï¼è½¬æ¢å™¨ä¸­å®Œæˆçš„ï¼Œä»åƒblenderï¼mayaï¼3dsmaxçš„3Dè½¯ä»¶åŒ…ä¸­è·å–æ•°æ®ï¼Œå¹¶å¯¹äºæ¯ä¸ªé¡¶ç‚¹æ‰¾åˆ°æœ€å¤§çš„å››ä¸ªæƒé‡å¹¶å½’ä¸€åŒ–è¿™äº›æƒé‡ã€‚</p>
<p>ä¼ªä»£ç ç¤ºä¾‹ï¼Œéè’™çš®é¡¶ç‚¹é€šå¸¸ä¼šåƒè¿™æ ·è®¡ç®—</p>
<pre class="prettyprint"><code>gl_Position = projection * view * model * position;
</code></pre><p>è’™çš®é¡¶ç‚¹åƒè¿™æ ·è¢«æœ‰æ•ˆè®¡ç®—</p>
<pre class="prettyprint"><code>gl_Position = projection * view *
              (bone1Matrix * position * weight1 +
               bone2Matrix * position * weight2 +
               bone3Matrix * position * weight3 +
               bone4Matrix * position * weight4);
</code></pre><p>æ­£å¦‚ä½ çœ‹åˆ°çš„é‚£æ ·ï¼Œæ¯ä¸ªé¡¶ç‚¹è®¡ç®—å››ä¸ªä¸åŒçš„ä½ç½®ï¼Œç„¶åé€šè¿‡åº”ç”¨æƒé‡èåˆæˆä¸€ä¸ªã€‚</p>
<p>å‡è®¾ä½ å°†éª¨éª¼çŸ©é˜µå­˜å‚¨åœ¨å…¨å±€å˜é‡æ•°ç»„ä¸­, å¹¶ä¸”é€šè¿‡å±æ€§ä¼ å…¥æƒé‡ä»¥åŠæ˜¯å“ªä¸ªéª¨éª¼çš„æƒé‡ï¼Œä½ åº”è¯¥ä¼šè¿™æ ·åš</p>
<pre class="prettyprint"><code>attribute vec4 a_position;
attribute vec4 a_weights;         // æ¯ä¸ªé¡¶ç‚¹4ä¸ªæƒé‡
attribute vec4 a_boneNdx;         // 4ä¸ªéª¨éª¼ä¸‹æ ‡
uniform mat4 bones[MAX_BONES];    // æ¯ä¸ªéª¨éª¼1ä¸ªçŸ©é˜µ

gl_Position = projection * view *
              (a_bones[int(a_boneNdx[0])] * a_position * a_weight[0] +
               a_bones[int(a_boneNdx[1])] * a_position * a_weight[1] +
               a_bones[int(a_boneNdx[2])] * a_position * a_weight[2] +
               a_boneS[int(a_boneNdx[3])] * a_position * a_weight[3]);
</code></pre><p>è¿™è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ã€‚å‡è®¾ä½ æœ‰ä¸€ä¸ªäººçš„æ¨¡å‹ï¼ŒåŸç‚¹(0,0,0)åœ¨ä¸¤è„šä¹‹é—´çš„åœ°ä¸Šã€‚</p>
<div class="webgl_center"><img src="../resources/bone-head.svg" style="width: 500px;"></div>

<p>å‡è®¾ä½ æ”¾ä¸€ä¸ªçŸ©é˜µmatrix/éª¨éª¼bone/å…³èŠ‚jointåœ¨å¤´çš„ä½ç½®ï¼Œå¹¶æƒ³ç”¨å®ƒä½œä¸ºè’™çš®çš„éª¨éª¼ã€‚ç®€å•èµ·è§ï¼Œå‡è®¾ä½ åªè®¾å®šäº†å¤´éƒ¨çš„é¡¶ç‚¹æœ‰1.0çš„æƒé‡å¯¹äºå¤´éƒ¨éª¨éª¼ï¼Œå…¶ä»–åœ°æ–¹çš„å…³èŠ‚ä¸å½±å“è¿™äº›é¡¶ç‚¹ã€‚</p>
<div class="webgl_center"><img src="../resources/bone-head-setup.svg" style="width: 500px;"></div>

<p>è¿™ä¼šæœ‰ä¸€ä¸ªé—®é¢˜ã€‚å¤´éƒ¨é¡¶ç‚¹åœ¨åŸç‚¹ä¸Šæ–¹2ä¸ªå•ä½ã€‚å¤´éƒ¨éª¨éª¼ä¹Ÿåœ¨åŸç‚¹ä¸Šæ–¹2ä¸ªå•ä½ã€‚å¦‚æœä½ çœŸçš„å°†å¤´éƒ¨é¡¶ç‚¹å’Œå¤´éƒ¨éª¨éª¼çŸ©é˜µç›¸ä¹˜ï¼Œä½ å°†å¾—åˆ°åŸç‚¹ä¸Šæ–¹4ä¸ªå•ä½çš„é¡¶ç‚¹ä½ç½®ã€‚åŸæœ¬é¡¶ç‚¹çš„2ä¸ªå•ä½ + å¤´éƒ¨éª¨éª¼çŸ©é˜µçš„2ä¸ªå•ä½ã€‚</p>
<div class="webgl_center"><img src="../resources/bone-head-problem.svg" style="width: 500px;"></div>

<p>ä¸€ç§è§£å†³æ–¹æ¡ˆæ˜¯å­˜å‚¨&quot;ç»‘å®šå§¿åŠ¿&quot;ï¼Œè¿™æ˜¯æ¯ä¸ªå…³èŠ‚çš„é¢å¤–çŸ©é˜µï¼Œä½ ç”¨çŸ©é˜µæ¥ä½œç”¨äºé¡¶ç‚¹ä½ç½®ä¹‹å‰çš„ä½ç½®ã€‚è¿™ä¸ªä¾‹å­ï¼Œå¤´éƒ¨çŸ©é˜µçš„ç»‘å®šå§¿åŠ¿æ¯”åŸç‚¹é«˜2ä¸ªå•ä½ã€‚æ‰€ä»¥ç°åœ¨ä½ å¯ä»¥ä½¿ç”¨è¯¥çŸ©é˜µçš„é€†æ¥å‡å»é¢å¤–çš„2ä¸ªçŸ©é˜µã€‚</p>
<p>æ¢å¥è¯è¯´ï¼Œä¼ é€’ç»™ç€è‰²å™¨çš„éª¨éª¼çŸ©é˜µæ¯ä¸ªéƒ½ä¹˜ä»¥äº†ä»–ä»¬çš„ç»‘å®šå§¿åŠ¿çš„é€†çŸ©é˜µï¼Œä»¥ä¾¿åªå½±å“ä»åŸæœ‰ä½ç½®çš„å˜åŒ–ï¼Œç›¸å¯¹äºç½‘æ ¼åŸç‚¹ã€‚</p>
<p>æˆ‘ä»¬ä¸¾ä¸€ä¸ªä¾‹å­ã€‚æˆ‘ä»¬å°†åˆ¶ä½œåƒè¿™æ ·çš„æ ¼å­åŠ¨ç”»</p>
<div class="webgl_center"><img src="../resources/skinned-mesh.svg" style="width: 400px;"></div>

<ul>
<li><code>b0</code>, <code>b1</code>å’Œ <code>b2</code>æ˜¯éª¨éª¼çŸ©é˜µã€‚</li>
<li><code>b1</code>æ˜¯<code>b0</code>çš„å­ï¼Œ<code>b2</code>æ˜¯<code>b1</code>çš„å­</li>
<li>ç‚¹<code>0,1</code>å¯¹äºéª¨éª¼b0çš„æƒé‡ä¸º1.0 </li>
<li>ç‚¹<code>2,3</code>å¯¹äºéª¨éª¼b0å’Œéª¨éª¼b1çš„æƒé‡éƒ½ä¸º0.5</li>
<li>ç‚¹<code>4,5</code>å¯¹äºéª¨éª¼b1çš„æƒé‡ä¸º1.0 </li>
<li>ç‚¹<code>6,7</code>å¯¹äºéª¨éª¼b1å’Œéª¨éª¼b2çš„æƒé‡éƒ½ä¸º0.5 </li>
<li>ç‚¹<code>8,9</code>å¯¹äºéª¨éª¼b2çš„æƒé‡ä¸º1.0</li>
</ul>
<p>æˆ‘ä»¬ä¼šä½¿ç”¨<a href="webgl-less-code-more-fun.html">ç å°‘è¶£å¤š</a>æ–‡ç« ä¸­ä»‹ç»çš„utils.</p>
<p>é¦–å…ˆæˆ‘ä»¬éœ€è¦é¡¶ç‚¹ä½ç½®å’Œå½±å“æ¯ä¸ªé¡¶ç‚¹çš„æ¯ä¸ªéª¨éª¼ä¸‹æ ‡ä»¥åŠ0åˆ°1çš„æ•°å­—æƒé‡è¡¨ç¤ºè¿™ä¸ªéª¨éª¼çš„å½±å“é‡ã€‚</p>
<pre class="prettyprint"><code>var arrays = {
  position: {
    numComponents: 2,
    data: [
     0,  1,  // 0
     0, -1,  // 1
     2,  1,  // 2
     2, -1,  // 3
     4,  1,  // 4
     4, -1,  // 5
     6,  1,  // 6
     6, -1,  // 7
     8,  1,  // 8
     8, -1,  // 9
    ],
  },
  boneNdx: {
    numComponents: 4,
    data: [
      0, 0, 0, 0,  // 0
      0, 0, 0, 0,  // 1
      0, 1, 0, 0,  // 2
      0, 1, 0, 0,  // 3
      1, 0, 0, 0,  // 4
      1, 0, 0, 0,  // 5
      1, 2, 0, 0,  // 6
      1, 2, 0, 0,  // 7
      2, 0, 0, 0,  // 8
      2, 0, 0, 0,  // 9
    ],
  },
  weight: {
    numComponents: 4,
    data: [
     1, 0, 0, 0,  // 0
     1, 0, 0, 0,  // 1
    .5,.5, 0, 0,  // 2
    .5,.5, 0, 0,  // 3
     1, 0, 0, 0,  // 4
     1, 0, 0, 0,  // 5
    .5,.5, 0, 0,  // 6
    .5,.5, 0, 0,  // 7
     1, 0, 0, 0,  // 8
     1, 0, 0, 0,  // 9
    ],
  },

  indices: {
    numComponents: 2,
    data: [
      0, 1,
      0, 2,
      1, 3,
      2, 3, //
      2, 4,
      3, 5,
      4, 5,
      4, 6,
      5, 7, //
      6, 7,
      6, 8,
      7, 9,
      8, 9,
    ],
  },
};
// è°ƒç”¨gl.createBuffer, gl.bindBuffer, gl.bufferData
var bufferInfo = webglUtils.createBufferInfoFromArrays(gl, arrays);
</code></pre><p>æˆ‘ä»¬å®šä¹‰å…¨å±€å˜é‡åŒ…æ‹¬å¯¹åº”æ¯ä¸ªéª¨éª¼çš„çŸ©é˜µ</p>
<pre class="prettyprint"><code>// 4ä¸ªçŸ©é˜µ, æ¯ä¸ªéª¨éª¼ä¸€ä¸ª
var numBones = 4;
var boneArray = new Float32Array(numBones * 16);

var uniforms = {
  projection: m4.orthographic(-20, 20, -10, 10, -1, 1),
  view: m4.translation(-6, 0, 0),
  bones: boneArray,
  color: [1, 0, 0, 1],
};
</code></pre><p>åœ¨boneArrayä¸­åˆ›å»ºè§†å›¾ï¼Œæ¯ä¸ªçŸ©é˜µä¸€ä¸ª</p>
<pre class="prettyprint"><code>// ä¸ºæ‰€æœ‰éª¨éª¼åˆ›å»ºè§†å›¾
// åœ¨ä¸€ä¸ªæ•°ç»„ä¸­ä»¥ä¾¿ä¸Šä¼ ï¼Œä½†æ˜¯æ˜¯åˆ†å‰²çš„
// æ•°å­¦è®¡ç®—ç”¨åˆ°çš„æ•°ç»„
var boneMatrices = [];  // å…¨å±€å˜é‡æ•°æ®
var bones = [];         // ä¹˜ä»¥ç»‘å®šçŸ©é˜µçš„é€†ä¹‹å‰çš„å€¼
var bindPose = [];      // ç»‘å®šçŸ©é˜µ
for (var i = 0; i &lt; numBones; ++i) {
  boneMatrices.push(new Float32Array(boneArray.buffer, i * 4 * 16, 16));
  bindPose.push(m4.identity());  // ä»…ä»…åˆ†é…å­˜å‚¨ç©ºé—´
  bones.push(m4.identity());     // ä»…ä»…åˆ†é…å­˜å‚¨ç©ºé—´
}
</code></pre><p>æ¥ä¸‹æ¥æ˜¯ä¸€äº›è®¡ç®—éª¨éª¼çŸ©é˜µçš„ä»£ç ã€‚æˆ‘ä»¬ä»…ä»…æ˜¯åœ¨å±‚çº§ä¸­æ—‹è½¬ä»–ä»¬å°±åƒæ‰‹æŒ‡çš„éª¨å¤´ä¸€æ ·ã€‚</p>
<pre class="prettyprint"><code>// æ—‹è½¬æ¯ä¸ªéª¨éª¼è§’åº¦ï¼Œæ¨¡æ‹Ÿä¸€ä¸ªå±‚çº§
function computeBoneMatrices(bones, angle) {
  var m = m4.identity();
  m4.zRotate(m, angle, bones[0]);
  m4.translate(bones[0], 4, 0, 0, m);
  m4.zRotate(m, angle, bones[1]);
  m4.translate(bones[1], 4, 0, 0, m);
  m4.zRotate(m, angle, bones[2]);
  // bones[3]æ²¡æœ‰ç”¨
}
</code></pre><p>ç°åœ¨è°ƒç”¨ä¸€æ¬¡æ¥ç”Ÿæˆä»–ä»¬çš„åˆå§‹ä½ç½®ï¼ˆç»‘å®šå§¿åŠ¿ï¼‰ï¼Œç”¨ç»“æœæ¥è®¡ç®—ç»‘å®šå§¿åŠ¿çŸ©é˜µçš„é€†ã€‚</p>
<pre class="prettyprint"><code>// è®¡ç®—æ¯ä¸ªçŸ©é˜µçš„åˆå§‹ä½ç½®
computeBoneMatrices(bindPose, 0);

// è®¡ç®—ä»–ä»¬çš„é€†
var bindPoseInv = bindPose.map(function(m) {
  return m4.inverse(m);
});
</code></pre><p>ç°åœ¨æˆ‘ä»¬å¯ä»¥å¼€å§‹æ¸²æŸ“</p>
<p>é¦–å…ˆæˆ‘ä»¬ä¸ºéª¨éª¼è®¾ç½®åŠ¨ç”»ï¼Œä¸ºæ¯ä¸ªéª¨éª¼è®¡ç®—ä¸€ä¸ªæ–°çš„ä¸–ç•ŒçŸ©é˜µ</p>
<pre class="prettyprint"><code>var t = time * 0.001;
var angle = Math.sin(t) * 0.8;
computeBoneMatrices(bones, angle);
</code></pre><p>ä¹‹åæˆ‘ä»¬å°†ç»“æœä¹˜ä»¥ç»‘å®šå§¿åŠ¿çš„é€†æ¥è§£å†³ä¹‹å‰æåˆ°çš„é—®é¢˜</p>
<pre class="prettyprint"><code>// æ¯ä¸ªéƒ½ä¹˜ä»¥ç»‘å®šçŸ©é˜µçš„é€†
bones.forEach(function(bone, ndx) {
  m4.multiply(bone, bindPoseInv[ndx], boneMatrices[ndx]);
});
</code></pre><p>ç„¶åå°±æ˜¯æ‰€æœ‰å¸¸è§„çš„æ­¥éª¤ï¼Œè®¾ç½®å±æ€§ï¼Œè®¾ç½®å…¨å±€å˜é‡ï¼Œæ¸²æŸ“</p>
<pre class="prettyprint"><code>gl.useProgram(programInfo.program);
// è°ƒç”¨gl.bindBuffer, gl.enableVertexAttribArray, gl.vertexAttribPointer
webglUtils.setBuffersAndAttributes(gl, programInfo, bufferInfo);

// è°ƒç”¨gl.uniformXXX, gl.activeTexture, gl.bindTexture
webglUtils.setUniforms(programInfo, uniforms);

// è°ƒç”¨gl.drawArrays or gl.drawIndices
webglUtils.drawBufferInfo(gl, bufferInfo, gl.LINES);
</code></pre><p>è¿™æ˜¯ç»“æœ</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-skinning.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-skinning.html" target="_blank">ç‚¹æ­¤åœ¨æ–°çª—å£ä¸­æµè§ˆ</a>
</div>

</p>
<p>çº¢çº¿æ˜¯<em>è’™çš®</em>ç½‘æ ¼ã€‚ç»¿çº¿å’Œè“çº¿åˆ†åˆ«ä»£è¡¨æ¯ä¸ªéª¨éª¼æˆ–è€…â€œå…³èŠ‚â€çš„xè½´å’Œyè½´ã€‚ä½ å¯ä»¥çœ‹åˆ°é¡¶ç‚¹æ˜¯å¦‚ä½•å—å¤šä¸ªéª¨éª¼å½±å“å¹¶åœ¨ä»–ä»¬ä¹‹é—´ç§»åŠ¨çš„ã€‚æˆ‘ä»¬æ²¡æœ‰ä»‹ç»å¦‚ä½•ç»˜åˆ¶éª¨éª¼ï¼Œå› ä¸ºå®ƒå¯¹äºè§£é‡Šè’™çš®æ€ä¹ˆå·¥ä½œä¸é‡è¦ã€‚å¦‚æœä½ æ„Ÿå…´è¶£å‚è§ä»£ç ã€‚</p>
<p>æ³¨æ„: éª¨éª¼bones vs å…³èŠ‚joints è®©äººè¿·æƒ‘ã€‚éƒ½æŒ‡çš„æ˜¯1ä»¶äº‹æƒ…ï¼Œ<em>çŸ©é˜µ</em>ã€‚
ä½†æ˜¯ï¼Œåœ¨3dæ¨¡å‹åŒ…ä¸­é€šå¸¸ç”»ä¸€ä¸ªgizmo(ä¸€ä¸ªuiéƒ¨ä»¶)
åœ¨çŸ©é˜µä¹‹é—´ã€‚æœ€ç»ˆçœ‹èµ·æ¥åƒéª¨éª¼ä¸€æ ·ã€‚å…³èŠ‚æ˜¯çŸ©é˜µæ‰€å¤„çš„ä½ç½®ï¼Œä»–ä»¬ä»ä¸€ä¸ªå…³èŠ‚åˆ°ä¸‹ä¸€ä¸ªç”»ä¸€æ¡çº¿æˆ–é”¥ä½“ä½¿å®ƒçœ‹èµ·æ¥åƒä¸€ä¸ªéª¨æ¶ã€‚</p>
<div class="webgl_center">
  <img src="../resources/bone-display.png" style="width: 351px;">
  <div class="caption"><a href="https://www.blendswap.com/blends/view/66412">LowPoly Man</a> by <a href="https://www.blendswap.com/user/TiZeta">TiZeta</a></div>
</div>

<p>å¦ä¸€ä¸ªéœ€è¦æ³¨æ„çš„å°äº‹ï¼Œä¸Šé¢çš„ä¾‹å­æƒé‡å’Œéª¨éª¼ä¸‹æ ‡ä½¿ç”¨çš„æ˜¯æµ®ç‚¹æ•°ï¼Œå¯ä»¥ä½¿ç”¨<code>UNSIGNED_BYTE</code>æ¥èŠ‚çœä¸€äº›ç©ºé—´ã€‚</p>
<p>ä¸å¹¸çš„æ˜¯ç€è‰²å™¨ä¸­å¯ä»¥ä½¿ç”¨çš„å…¨å±€å˜é‡çš„æ•°é‡æ˜¯æœ‰é™åˆ¶çš„ã€‚å¯¹WebGLæ¯”è¾ƒä½çš„é™åˆ¶æ˜¯64ä¸ªvec4ï¼Œå³8ä¸ªmat4 ä½ å¯èƒ½éœ€è¦ä¸€äº›å…¨å±€å˜é‡ç”¨äºå…¶ä»–çš„äº‹æƒ…åƒç‰‡æ–­ç€è‰²å™¨ä¸­çš„<code>color</code> ä»¥åŠ<code>projection</code>å’Œ<code>view</code>è¿™æ„å‘³ç€å¦‚æœæˆ‘ä»¬åœ¨ä¸€ä¸ªé™åˆ¶ä¸º64ä¸ªvec4çš„è®¾å¤‡ä¸Šï¼Œæˆ‘ä»¬åªèƒ½æœ‰5ä¸ªéª¨éª¼ï¼æŸ¥çœ‹
<a href="https://webglstats.com/webgl/parameter/MAX_VERTEX_UNIFORM_VECTORS">WebGLStats</a>
å¤§å¤šæ•°è®¾å¤‡æ”¯æŒ128ä¸ªvec4ï¼Œå…¶ä¸­70%æ”¯æŒ256ä¸ªvec4 ä½†æ˜¯å¯¹äºä¸Šé¢çš„ä¾‹å­ï¼Œè¿™åˆ†åˆ«åªæœ‰13ä¸ªéª¨éª¼å’Œ29ä¸ªéª¨éª¼ã€‚13å¯¹äº90å¹´ä»£VRæˆ˜å£«1é£æ ¼çš„è§’è‰²å°šä¸”ä¸å¤Ÿï¼Œ29ä¸ç°ä»£æ¸¸æˆä¸­ä½¿ç”¨çš„æ•°å­—ç›¸è·ç”šè¿œã€‚</p>
<p>å…³äºè¿™ä¸ªé—®é¢˜æœ‰å¾ˆå¤šæ–¹æ³•ã€‚ä¸€ä¸ªæ˜¯ç¦»çº¿é¢„å¤„ç†æ¨¡å‹å¹¶æ‰“ç ´å®ƒä»¬ä¸ºå¤šä¸ªéƒ¨åˆ†ï¼Œæ¯ä¸ªä½¿ç”¨ä¸è¶…è¿‡Nä¸ªéª¨éª¼ã€‚è¿™å¾ˆå¤æ‚å¹¶å¸¦æ¥äº†è‡ªèº«çš„ä¸€ç³»åˆ—é—®é¢˜ã€‚</p>
<p>å¦ä¸€ç§æ˜¯å°†éª¨éª¼çŸ©é˜µå­˜å‚¨åœ¨çº¹ç†ä¸­ã€‚ä¸€ä¸ªé‡è¦çš„å¯ç¤ºçº¹ç†ä¸ä»…ä»…æ˜¯å›¾ç‰‡ï¼Œå®ƒä»¬å®é™…ä¸Šæ˜¯ä½ å¯ä»¥ä¼ é€’ç»™ç€è‰²å™¨çš„éšæœºè®¿é—®çš„2Dæ•°ç»„æ•°æ®ï¼Œä½ å¯ä»¥ä½¿ç”¨å®ƒä»¬åšå„ç§äº‹æƒ…ï¼Œä¸ä»…ä»…æ˜¯è¯»å–å›¾åƒã€‚</p>
<p>è®©æˆ‘ä»¬ç”¨çº¹ç†ä¼ é€’çŸ©é˜µæ¥ç»•è¿‡å…¨å±€å˜é‡çš„é™åˆ¶é—®é¢˜ã€‚è®©å…¶ç®€å•æˆ‘ä»¬å‡†å¤‡ä½¿ç”¨æµ®ç‚¹å‹çº¹ç†ã€‚æµ®ç‚¹å‹çº¹ç†æ˜¯WebGLçš„å¯é€‰åŠŸèƒ½ä½†æ˜¯å¹¸è¿çš„æ˜¯å¤§å¤šæ•°è®¾å¤‡æ”¯æŒå®ƒã€‚</p>
<p>è¿™æ˜¯è·å¾—æ‰©å±•çš„ä»£ç ã€‚å¦‚æœå®ƒå¤±è´¥äº†ï¼Œæˆ‘ä»¬å¯èƒ½è¦å‘Šè¯‰ç”¨æˆ·ä»–ä»¬è¿æ°”ä¸å¥½æˆ–è€…é€‰æ‹©å…¶ä»–è§£å†³æ–¹æ¡ˆã€‚</p>
<pre class="prettyprint"><code>var ext = gl.getExtension(&#39;OES_texture_float&#39;);
if (!ext) {
  return;  // æ‰©å±•åœ¨è¿™ä¸ªè®¾å¤‡ä¸Šä¸å­˜åœ¨
}
</code></pre><p>è®©æˆ‘ä»¬æ›´æ–°ç€è‰²å™¨ä»çº¹ç†ä¸­è·å–çŸ©é˜µã€‚
æˆ‘ä»¬ä¼šåˆ¶ä½œæ¯è¡Œä¸€ä¸ªçŸ©é˜µçš„çº¹ç†ã€‚çº¹ç†çš„æ¯ä¸ªçº¹ç´ texel
æœ‰Rï¼ŒGï¼ŒBå’ŒAï¼Œè¿™æ˜¯4ä¸ªå€¼æ‰€ä»¥æ¯ä¸ªçŸ©é˜µæˆ‘ä»¬åªéœ€4ä¸ªåƒç´ ï¼Œä¸€ä¸ªåƒç´ å¯¹åº”çŸ©é˜µçš„æ¯ä¸€è¡Œã€‚çº¹ç†åœ¨æŸä¸€çº¬åº¦ä¸Šçš„é™åˆ¶é€šå¸¸è‡³å°‘2048ä¸ªåƒç´ ï¼Œæ‰€ä»¥è¿™ä¼šç»™æˆ‘ä»¬è‡³å°‘2048çš„éª¨éª¼çŸ©é˜µçš„ç©ºé—´ï¼Œè¿™å·²è¶³å¤Ÿã€‚</p>
<pre class="prettyprint"><code>attribute vec4 a_position;
attribute vec4 a_weight;
attribute vec4 a_boneNdx;

uniform mat4 projection;
uniform mat4 view;
*uniform sampler2D boneMatrixTexture;
*uniform float numBones;

+// è¿™äº›åç§»å‡è®¾çº¹ç†æ¯è¡Œ4åƒç´ 
+#define ROW0_U ((0.5 + 0.0) / 4.)
+#define ROW1_U ((0.5 + 1.0) / 4.)
+#define ROW2_U ((0.5 + 2.0) / 4.)
+#define ROW3_U ((0.5 + 3.0) / 4.)
+
+mat4 getBoneMatrix(float boneNdx) {
+  float v = (boneNdx + 0.5) / numBones;
+  return mat4(
+    texture2D(boneMatrixTexture, vec2(ROW0_U, v)),
+    texture2D(boneMatrixTexture, vec2(ROW1_U, v)),
+    texture2D(boneMatrixTexture, vec2(ROW2_U, v)),
+    texture2D(boneMatrixTexture, vec2(ROW3_U, v)));
+}

void main() {

  gl_Position = projection * view *
*                (getBoneMatrix(a_boneNdx[0]) * a_position * a_weight[0] +
*                 getBoneMatrix(a_boneNdx[1]) * a_position * a_weight[1] +
*                 getBoneMatrix(a_boneNdx[2]) * a_position * a_weight[2] +
*                 getBoneMatrix(a_boneNdx[3]) * a_position * a_weight[3]);

}
</code></pre><p>éœ€è¦æ³¨æ„çš„ä¸€ç‚¹æ˜¯ï¼Œçº¹ç†ä¸­åƒç´ çš„çº¹ç†åæ ‡æ˜¯ä»å®ƒä»¬çš„è¾¹ç¼˜è®¡ç®—çš„ã€‚åƒæˆ‘ä»¬åœ¨<a href="webgl-3d-textures.html">çº¹ç†</a>çš„æ–‡ç« ä¸­æåˆ°çš„çº¹ç†åæ ‡ä»0åˆ°1ã€‚0æ˜¯æœ€å·¦è¾¹ç¼˜çš„åƒç´ ï¼Œ1æ˜¯æœ€å³è¾¹ç¼˜çš„åƒç´ ã€‚å¦‚æœä½ æœ‰å®½åº¦ä¸º3åƒç´ çš„çº¹ç†ï¼Œé‚£å°±åƒè¿™æ ·ã€‚</p>
<div class="webgl_center"><img src="../resources/texel-coords.svg" style="width: 400px;"></div>

<p>é€‰å–æŸä¸ªç‰¹å®šåƒç´ ï¼Œé‚£ä¹ˆå…¬å¼æ˜¯</p>
<pre class="prettyprint"><code> (x + .5) / width
</code></pre><p>ä¸Šé¢çš„æ¯ä¸ªåƒç´ æ˜¯</p>
<pre class="prettyprint"><code> (0 + .5) / 3  = 0.166
 (1 + .5) / 3 =  0.5
 (2 + .5) / 3 =  0.833
</code></pre><p>æˆ–è€…</p>
<div class="webgl_center"><img src="../resources/texel-coords-middle.svg" style="width: 400px;"></div>

<p>ç°åœ¨æˆ‘ä»¬è®¾å®šä¸€ä¸ªæ”¾å…¥éª¨éª¼çŸ©é˜µçš„çº¹ç†</p>
<pre class="prettyprint"><code>// å‡†å¤‡çº¹ç†æ¥å­˜éª¨éª¼çŸ©é˜µ
var boneMatrixTexture = gl.createTexture();
gl.bindTexture(gl.TEXTURE_2D, boneMatrixTexture);
// å› ä¸ºæˆ‘ä»¬å¸Œæœ›ä½¿ç”¨çº¹ç†çš„åŸå§‹æ•°æ®
// æˆ‘ä»¬å…³é—­ç­›é€‰
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
// ä¹Ÿå…³é—­åŒ…è£¹ï¼Œå› ä¸ºçº¹ç†ä¹Ÿè®¸ä¸æ˜¯2çš„å¹‚
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
</code></pre><p>æˆ‘ä»¬ä¼šç”¨å…¨å±€å˜é‡ä¼ é€’çº¹ç†å’Œéª¨éª¼çš„æ•°é‡</p>
<pre class="prettyprint"><code>var uniforms = {
  projection: m4.orthographic(-20, 20, -10, 10, -1, 1),
  view: m4.translation(-6, 0, 0),
*  boneMatrixTexture,
*  numBones,
  color: [1, 0, 0, 1],
};
</code></pre><p>ç„¶åæˆ‘ä»¬å”¯ä¸€éœ€è¦æ”¹å˜çš„æ˜¯åœ¨æ¸²æŸ“æ—¶ç”¨æœ€æ–°çš„éª¨éª¼çŸ©é˜µæ›´æ–°çº¹ç†</p>
<pre class="prettyprint"><code>// ç”¨æ­¤æ—¶çš„çŸ©é˜µæ›´æ–°çº¹ç†
gl.bindTexture(gl.TEXTURE_2D, boneMatrixTexture);
gl.texImage2D(
    gl.TEXTURE_2D,
    0,         // å±‚çº§
    gl.RGBA,   // å†…éƒ¨æ ¼å¼
    4,         // 4åƒç´ å®½,æ¯ä¸ªåƒç´ RGBA4ä¸ªé€šé“æ‰€ä»¥4åƒç´ æ˜¯16ä¸ªå€¼
    numBones,  // æ¯ä¸ªéª¨éª¼ä¸€è¡Œ
    0,         // è¾¹æ¡†
    gl.RGBA,   // æ ¼å¼
    gl.FLOAT,  // ç±»å‹
    boneArray);
</code></pre><p>ç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½†æˆ‘ä»¬å·²ç»è§£å†³äº†æ²¡æœ‰è¶³å¤Ÿçš„å…¨å±€å˜é‡æ¥ä¼ é€’çŸ©é˜µçš„é—®é¢˜</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-skinning-bone-matrices-in-texture.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-skinning-bone-matrices-in-texture.html" target="_blank">ç‚¹æ­¤åœ¨æ–°çª—å£ä¸­æµè§ˆ</a>
</div>

</p>
<p>æ‰€ä»¥è¿™å°±æ˜¯è’™çš®çš„åŸºç¡€çŸ¥è¯†ã€‚å†™å‘ˆç°è’™çš®ç½‘æ ¼çš„ä»£ç å¹¶ä¸å›°éš¾ã€‚æ›´å›°éš¾çš„éƒ¨åˆ†å®é™…ä¸Šæ˜¯è·å–æ•°æ®ã€‚ä½ é€šå¸¸éœ€è¦ä¸€äº›3Dè½¯ä»¶åƒblender/maya/3d studio maxï¼Œç„¶åè¦ä¹ˆå†™ä½ è‡ªå·±çš„å¯¼å‡ºå™¨æˆ–è€…æ‰¾åˆ°ä¸€ä¸ªå¯¼å‡ºå™¨æä¾›æ‰€æœ‰ä½ éœ€è¦çš„æ•°æ®ã€‚ä½ ä¼šçœ‹åˆ°åƒæˆ‘ä»¬ä»‹ç»çš„ä¸€æ ·åŠ è½½è’™çš®ç›¸è¾ƒäºå±•ç¤ºå®ƒä¼šæœ‰10å€å¤šçš„ä»£ç ï¼Œè¿™è¿˜ä¸åŒ…æ‹¬å¤§çº¦20-30å€å¤šçš„ä»£ç ä»3Dç¨‹åºä¸­å¯¼å‡ºçš„å¯¼å‡ºå™¨ã€‚é¢˜å¤–è¯è¿™éƒ¨åˆ†é€šå¸¸æ˜¯äººä»¬å†™ä»–ä»¬çš„3Då¼•æ“é€šå¸¸å¿½ç•¥çš„ã€‚å¼•æ“æ˜¯ç®€å•çš„éƒ¨åˆ†ğŸ˜œ</p>
<p>å°†ä¼šæœ‰å¾ˆå¤šä»£ç ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å…ˆå°è¯•æ˜¾ç¤ºæœªè’™çš®çš„æ¨¡å‹ã€‚</p>
<p>è®©æˆ‘ä»¬å°è¯•åŠ è½½ä¸€ä¸ªglTFæ–‡ä»¶ã€‚ <a href="https://www.khronos.org/gltf/">glTF</a>æ˜¯ä¸ºWebGLè€Œè®¾è®¡çš„ã€‚åœ¨ç½‘ä¸Šæˆ‘æ‰¾åˆ°äº†è¿™ä¸ª<a href="https://www.blendswap.com/blends/view/65255">è™é²¸æ–‡ä»¶</a>æ˜¯<a href="https://www.blendswap.com/user/pasilan">Junskie Pastilan</a>åˆ¶ä½œçš„ã€‚</p>
<div class="webgl_center"><img src="../../resources/models/killer_whale/thumbnail.jpg"></div>

<p>glTFæœ‰ä¸¤ç§æ ¼å¼ã€‚<code>.gltf</code>æ ¼å¼æ˜¯ä¸€ä¸ªJSONæ–‡ä»¶é€šå¸¸å¼•ç”¨ä¸€ä¸ª <code>.bin</code>æ–‡ä»¶ï¼Œè¿™æ˜¯ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶é€šå¸¸åªåŒ…å«å‡ ä½•ä½“ï¼Œå¯èƒ½åŒ…å«åŠ¨ç”»æ•°æ®ã€‚å¦ä¸€ç§æ ¼å¼æ˜¯<code>.glb</code>äºŒè¿›åˆ¶æ ¼å¼ã€‚é€šå¸¸æ˜¯JSONå’Œå…¶ä»–æ–‡ä»¶è¿æ¥åˆ°ä¸€ä¸ªäºŒè¿›åˆ¶æ–‡ä»¶å†…ï¼Œæ¯ä¸ªè¿æ¥éƒ¨åˆ†ä¹‹é—´æœ‰ä¸€ä¸ªçŸ­å¤´å’Œä¸€ä¸ªå¤§å°ï¼ç±»å‹æè¿°ã€‚å¯¹äºJavaScriptï¼Œæˆ‘è®¤ä¸º<code>.gltf</code>æ ¼å¼ç¨å¾®å®¹æ˜“ä¸Šæ‰‹ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬å°è¯•åŠ è½½å®ƒã€‚</p>
<p>é¦–å…ˆæˆ‘ä¸‹è½½äº†<a href="https://www.blendswap.com/blends/view/65255">.blendæ–‡ä»¶</a>ï¼Œå®‰è£…<a href="https://blender.org">blender</a>ï¼Œå®‰è£…<a href="https://github.com/KhronosGroup/glTF-Blender-IO">gltfå¯¼å‡ºå™¨</a>ï¼Œblenderä¸­åŠ è½½æ–‡ä»¶å¹¶å¯¼å‡ºã€‚</p>
<div class="webgl_center"><img src="../resources/blender-killer-whale.png" style="width: 700px;"></div>

<blockquote>
<p>å¿«é€Ÿè¯´æ˜ï¼š3Dè½¯ä»¶åƒBlenderï¼ŒMayaï¼Œ3DSMaxæ˜¯æå…¶å¤æ‚çš„è½¯ä»¶ï¼Œæœ‰1000å¤šç§é€‰é¡¹ã€‚å½“æˆ‘åœ¨1996å¹´ç¬¬ä¸€æ¬¡å­¦ä¹ 3DSMaxæ—¶ï¼Œæˆ‘å¤§çº¦3å‘¨æ¯å¤©èŠ±2-3å°æ—¶é˜…è¯»1000å¤šé¡µçš„æ‰‹å†Œï¼Œé€šè¿‡æ•™ç¨‹å·¥ä½œã€‚å‡ å¹´åï¼Œå½“æˆ‘å­¦ä¹ Mayaæ—¶ï¼Œæˆ‘åšäº†ç±»ä¼¼çš„äº‹æƒ…ã€‚BlenderåŒæ ·å¤æ‚å¹¶ä¸”æ›´ç”šå®ƒä¸å‡ ä¹æ‰€æœ‰å…¶ä»–è½¯ä»¶çš„ç•Œé¢éå¸¸ä¸åŒã€‚ä½ åº”è¯¥èŠ±è´¹ä¸€äº›æ—¶é—´æ¥å­¦ä¹ ä½ å†³å®šä½¿ç”¨çš„3Dè½¯ä»¶åŒ…ã€‚</p>
</blockquote>
<p>å¯¼å‡ºä¹‹åæˆ‘ç”¨æ–‡æœ¬ç¼–è¾‘å™¨æ‰“å¼€.gltfæ–‡ä»¶å¹¶æµè§ˆäº†ä¸€ä¸‹ã€‚æˆ‘ç”¨è¿™ä¸ª<a href="https://raw.githubusercontent.com/KhronosGroup/glTF/master/specification/2.0/figures/gltfOverview-2.0.0a.png">è¡¨</a>æ¥å¼„æ¸…æ¥šæ ¼å¼ã€‚</p>
<p>æˆ‘æƒ³è¯´æ˜ä¸‹é¢çš„ä»£ç ä¸æ˜¯ä¸€ä¸ªå®Œç¾çš„gltfåŠ è½½å™¨ï¼Œåªæ˜¯è¶³ä»¥å±•ç¤ºé²¸é±¼çš„ä»£ç ã€‚æˆ‘æ€€ç–‘å¦‚æœæˆ‘ä»¬å°è¯•ä¸åŒçš„æ–‡ä»¶ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°éœ€è¦æ›´æ”¹çš„åŒºåŸŸã€‚</p>
<p>é¦–å…ˆè¦åšçš„äº‹æƒ…æ˜¯åŠ è½½æ–‡ä»¶ã€‚ç®€å•èµ·è§ï¼Œæˆ‘ä»¬ä½¿ç”¨JavaScriptçš„<a href="https://javascript.info/async-await">async/await</a>ã€‚é¦–å…ˆæˆ‘ä»¬å†™ä¸€äº›ä»£ç æ¥åŠ è½½<code>.gltf</code> æ–‡ä»¶å’Œå®ƒå¼•ç”¨çš„æ–‡ä»¶ã€‚</p>
<pre class="prettyprint"><code>async function loadGLTF(url) {
  const gltf = await loadJSON(url);

  // åŠ è½½æ‰€æœ‰gltfæ–‡ä»¶ç›¸å…³è¿çš„æ–‡ä»¶
  const baseURL = new URL(url, location.href);
  gltf.buffers = await Promise.all(gltf.buffers.map((buffer) =&gt; {
    const url = new URL(buffer.uri, baseURL.href);
    return loadBinary(url.href);
  }));

  ...

async function loadFile(url, typeFunc) {
  const response = await fetch(url);
  if (!response.ok) {
    throw new Error(`could not load: ${url}`);
  }
  return await response[typeFunc]();
}

async function loadBinary(url) {
  return loadFile(url, &#39;arrayBuffer&#39;);
}

async function loadJSON(url) {
  return loadFile(url, &#39;json&#39;);
}
</code></pre><p>ç°åœ¨æˆ‘ä»¬éœ€è¦éå†æ•°æ®å°†å…¶è¿æ¥èµ·æ¥ã€‚</p>
<p>é¦–å…ˆè®©æˆ‘ä»¬ç€æ‰‹äºglTFå¦‚ä½•å®šä¹‰ä¸€ä¸ªç½‘æ ¼ã€‚ç½‘æ ¼æ˜¯å›¾å…ƒçš„é›†åˆã€‚å›¾å…ƒå®é™…ä¸Šæ˜¯æ¸²æŸ“æ‰€éœ€çš„ç¼“å†²å’Œå±æ€§ã€‚è®©æˆ‘ä»¬ä½¿ç”¨<a href="webgl-less-code-more-fun.html">ç å°‘è¶£å¤š</a>æ–‡ç« ä¸­å®ç°çš„webglUtilsã€‚æˆ‘ä»¬å°†éå†ç½‘æ ¼ï¼Œä¸ºæ¯ä¸ªç½‘æ ¼åˆ›å»ºä¸€ä¸ªä¼ é€’ç»™<code>webglUtils.setBuffersAndAttributes</code>çš„<code>BufferInfo</code>ã€‚å›å¿† <code>BufferInfo</code>å®é™…ä¸Šåªæ˜¯å±æ€§ä¿¡æ¯ï¼ŒåŠä¸‹æ ‡å¦‚æœæœ‰çš„è¯ï¼Œå’Œä¼ é€’ç»™<code>gl.drawXXX</code>çš„å…ƒç´ æ•°é‡ã€‚ä¸¾ä¸ªä¾‹å­ä¸€ä¸ªåªæœ‰ä½ç½®å’Œæ³•çº¿çš„ç«‹æ–¹ä½“ä¼šå…·æœ‰å¦‚ä¸‹ç»“æ„çš„BufferInfo</p>
<pre class="prettyprint"><code>const cubeBufferInfo = {
  attribs: {
    &#39;a_POSITION&#39;: { buffer: WebGLBuffer, type: gl.FLOAT, numComponents: 3, },
    &#39;a_NORMAL&#39;: { buffer: WebGLBuffer, type: gl.FLOAT, numComponents: 3, },
  },
  numElements: 24,
  indices: WebGLBuffer,
  elementType: gl.UNSIGNED_SHORT,
}
</code></pre><p>æ‰€ä»¥æˆ‘ä»¬å°†éå†æ¯ä¸ªå›¾å…ƒç”Ÿæˆä¸€ä¸ªåƒè¿™æ ·çš„BufferInfoã€‚</p>
<p>å›¾å…ƒæœ‰ä¸€ç»„å±æ€§ï¼Œæ¯ä¸ªå±æ€§å¼•ç”¨ä¸€ä¸ªè®¿é—®å™¨ã€‚è®¿é—®å™¨æè¿°æ˜¯å“ªç§æ•°æ®ï¼Œä¾‹å¦‚<code>VEC3</code>/<code>gl.FLOAT</code>å¹¶å¼•ç”¨ä¸€ä¸ªè§†å›¾ç¼“å†²ã€‚ç»™å®šä¸€ä¸ªè®¿é—®å™¨ä¸‹æ ‡ï¼Œæˆ‘ä»¬å¯ä»¥ç¼–å†™ä¸€äº›ä»£ç æ¥è¿”å›ä¸€ä¸ªWebGLBufferï¼Œå…¶ä¸­åŒ…å«åŠ è½½çš„æ•°æ®ï¼Œè®¿é—®å™¨å’Œï¼Œç¼“å†²è§†å›¾çš„strideã€‚</p>
<pre class="prettyprint"><code>// ç»™å®šä¸€ä¸ªè®¿é—®å™¨ä¸‹æ ‡è¿”å›ä¸€ä¸ªè®¿é—®å™¨, WebGLBufferå’Œä¸€ä¸ªstride
function getAccessorAndWebGLBuffer(gl, gltf, accessorIndex) {
  const accessor = gltf.accessors[accessorIndex];
  const bufferView = gltf.bufferViews[accessor.bufferView];
  if (!bufferView.webglBuffer) {
    const buffer = gl.createBuffer();
    const target = bufferView.target || gl.ARRAY_BUFFER;
    const arrayBuffer = gltf.buffers[bufferView.buffer];
    const data = new Uint8Array(arrayBuffer, bufferView.byteOffset, bufferView.byteLength);
    gl.bindBuffer(target, buffer);
    gl.bufferData(target, data, gl.STATIC_DRAW);
    bufferView.webglBuffer = buffer;
  }
  return {
    accessor,
    buffer: bufferView.webglBuffer,
    stride: bufferView.stride || 0,
  };
}
</code></pre><p>æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªå°†glTFè®¿é—®å™¨çš„typeç±»å‹è½¬æ¢ä¸ºæ•°å­—çš„æ–¹æ³•</p>
<pre class="prettyprint"><code>function throwNoKey(key) {
  throw new Error(`no key: ${key}`);
}

const accessorTypeToNumComponentsMap = {
  &#39;SCALAR&#39;: 1,
  &#39;VEC2&#39;: 2,
  &#39;VEC3&#39;: 3,
  &#39;VEC4&#39;: 4,
  &#39;MAT2&#39;: 4,
  &#39;MAT3&#39;: 9,
  &#39;MAT4&#39;: 16,
};

function accessorTypeToNumComponents(type) {
  return accessorTypeToNumComponentsMap[type] || throwNoKey(type);
}
</code></pre><p>ç°åœ¨æˆ‘ä»¬å·²ç»åˆ›å»ºäº†è¿™äº›å‡½æ•°ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ä»–ä»¬æ¥è®¾ç½®ç½‘æ ¼</p>
<p>æ³¨æ„ï¼šglTFæ–‡ä»¶å¯ä»¥å®šä¹‰æè´¨ï¼Œä½†æ˜¯å¯¼å‡ºå™¨å¹¶æ²¡æœ‰å¯¼å‡ºä»»ä½•æè´¨åˆ°æ–‡ä»¶å†…ï¼Œå³ä½¿å·²ç»å‹¾é€‰äº†å¯¼å‡ºæè´¨çš„é€‰é¡¹ã€‚æˆ‘åªèƒ½çŒœæµ‹åœ¨blenderä¸­å¯¼å‡ºå™¨ä¸å¤„ç†ä»»ä½•æè´¨ã€‚æˆ‘ä»¬ä¼šä½¿ç”¨é»˜è®¤æè´¨å¦‚æœæ–‡ä»¶ä¸­æ²¡æœ‰æè´¨çš„è¯ã€‚å› ä¸ºè¿™ä¸ªæ–‡ä»¶ä¸­æ²¡æœ‰ä»»ä½•æè´¨ï¼Œè¿™é‡Œæ²¡æœ‰ä½¿ç”¨glTFæè´¨çš„ä»£ç ã€‚</p>
<pre class="prettyprint"><code>const defaultMaterial = {
  uniforms: {
    u_diffuse: [.5, .8, 1, 1],
  },
};

// è®¾ç½®ç½‘æ ¼
gltf.meshes.forEach((mesh) =&gt; {
  mesh.primitives.forEach((primitive) =&gt; {
    const attribs = {};
    let numElements;
    for (const [attribName, index] of Object.entries(primitive.attributes)) {
      const {accessor, buffer, stride} = getAccessorAndWebGLBuffer(gl, gltf, index);
      numElements = accessor.count;
      attribs[`a_${attribName}`] = {
        buffer,
        type: accessor.componentType,
        numComponents: accessorTypeToNumComponents(accessor.type),
        stride,
        offset: accessor.byteOffset | 0,
      };
    }

    const bufferInfo = {
      attribs,
      numElements,
    };

    if (primitive.indices !== undefined) {
      const {accessor, buffer} = getAccessorAndWebGLBuffer(gl, gltf, primitive.indices);
      bufferInfo.numElements = accessor.count;
      bufferInfo.indices = buffer;
      bufferInfo.elementType = accessor.componentType;
    }

    primitive.bufferInfo = bufferInfo;

    // å­˜å‚¨å›¾å…ƒçš„æè´¨ä¿¡æ¯
    primitive.material = gltf.materials &amp;&amp; gltf.materials[primitive.material] || defaultMaterial;
  });
});
</code></pre><p>ç°åœ¨æ¯ä¸ªå›¾å…ƒéƒ½æœ‰ä¸€ä¸ª<code>bufferInfo</code>å’Œä¸€ä¸ª<code>material</code>å±æ€§ã€‚</p>
<p>å¯¹äºè’™çš®ï¼Œæˆ‘ä»¬é€šå¸¸éœ€è¦æŸç§åœºæ™¯å›¾ã€‚æˆ‘ä»¬åœ¨<a href="webgl-scene-graph.html">åœºæ™¯å›¾</a>çš„æ–‡ç« ä¸­åˆ›å»ºäº†ä¸€ä¸ªåœºæ™¯å›¾ï¼Œæ‰€ä»¥è®©æˆ‘ä»¬ä½¿ç”¨é‚£ä¸ªã€‚</p>
<pre class="prettyprint"><code>class TRS {
  constructor(position = [0, 0, 0], rotation = [0, 0, 0, 1], scale = [1, 1, 1]) {
    this.position = position;
    this.rotation = rotation;
    this.scale = scale;
  }
  getMatrix(dst) {
    dst = dst || new Float32Array(16);
    m4.compose(this.position, this.rotation, this.scale, dst);
    return dst;
  }
}

class Node {
  constructor(source, name) {
    this.name = name;
    this.source = source;
    this.parent = null;
    this.children = [];
    this.localMatrix = m4.identity();
    this.worldMatrix = m4.identity();
    this.drawables = [];
  }
  setParent(parent) {
    if (this.parent) {
      this.parent._removeChild(this);
      this.parent = null;
    }
    if (parent) {
      parent._addChild(this);
      this.parent = parent;
    }
  }
  updateWorldMatrix(parentWorldMatrix) {
    const source = this.source;
    if (source) {
      source.getMatrix(this.localMatrix);
    }

    if (parentWorldMatrix) {
      // ä¸€ä¸ªçŸ©é˜µä¼ å…¥ï¼Œæ‰€ä»¥åšæ•°å­¦è¿ç®—
      m4.multiply(parentWorldMatrix, this.localMatrix, this.worldMatrix);
    } else {
      // æ²¡æœ‰çŸ©é˜µä¼ å…¥ï¼Œæ‰€ä»¥åªæ˜¯æ‹·è´å±€éƒ¨çŸ©é˜µåˆ°ä¸–ç•ŒçŸ©é˜µ
      m4.copy(this.localMatrix, this.worldMatrix);
    }

    // ç°åœ¨å¤„ç†æ‰€æœ‰å­
    const worldMatrix = this.worldMatrix;
    for (const child of this.children) {
      child.updateWorldMatrix(worldMatrix);
    }
  }
  traverse(fn) {
    fn(this);
    for (const child of this.children) {
      child.traverse(fn);
    }
  }
  _addChild(child) {
    this.children.push(child);
  }
  _removeChild(child) {
    const ndx = this.children.indexOf(child);
    this.children.splice(ndx, 1);
  }
}
</code></pre><p>ç›¸è¾ƒäº<a href="webgl-scene-graph.html">åœºæ™¯å›¾</a>æ–‡ç« ä¸­çš„ä»£ç æœ‰ä¸€äº›å€¼çš„æ³¨æ„çš„å˜åŒ–ã€‚</p>
<ul>
<li><p>æ­¤ä»£ç ä½¿ç”¨ES6çš„<code>class</code>ç‰¹æ€§ã€‚</p>
<p>ä½¿ç”¨<code>class</code>è¯­æ³•æ¯”å®šä¹‰ç±»çš„æ—§æ–¹æ³•è¦å¥½å¾—å¤šã€‚</p>
</li>
<li><p>æˆ‘ä»¬ç»™<code>Node</code>æ·»åŠ äº†è¦ç»˜åˆ¶çš„æ•°ç»„</p>
<p>è¿™å°†åˆ—å‡ºä»æ­¤èŠ‚ç‚¹è¦ç»˜åˆ¶çš„çš„ç‰©ä½“ã€‚æˆ‘ä»¬ä¼šç”¨ç±»çš„å®ä¾‹å®é™…ä¸Šæ¥ç»˜åˆ¶ã€‚è¿™ä¸ªæ–¹æ³•æˆ‘ä»¬é€šå¸¸å¯ä»¥ç”¨ä¸åŒçš„ç±»ç»˜åˆ¶ä¸åŒçš„ç‰©ä½“ã€‚</p>
<p>æ³¨æ„ï¼šæˆ‘ä¸ç¡®å®šåœ¨Nodeé‡Œæ·»åŠ ä¸€ä¸ªè¦ç»˜åˆ¶çš„æ•°ç»„æ˜¯æœ€å¥½çš„æ–¹æ³•ã€‚æˆ‘è§‰å¾—åœºæ™¯å›¾æœ¬èº«åº”è¯¥å¯èƒ½ä¸åŒ…å«è¦ç»˜åˆ¶çš„ç‰©ä½“ã€‚éœ€è¦ç»˜åˆ¶çš„ä¸œè¥¿å¯æ”¹ä¸ºå›¾ä¸­èŠ‚ç‚¹çš„å¼•ç”¨æ¥è·å–æ•°æ®ã€‚è¦ç»˜åˆ¶ç‰©ä½“çš„æ–¹æ³•æ¯”è¾ƒå¸¸è§æ‰€ä»¥è®©æˆ‘ä»¬å¼€å§‹ä½¿ç”¨ã€‚</p>
</li>
<li><p>æˆ‘ä»¬å¢åŠ äº†ä¸€ä¸ª<code>traverse</code>æ–¹æ³•ã€‚</p>
<p>å®ƒç”¨å½“å‰èŠ‚ç‚¹è°ƒç”¨ä¼ å…¥çš„å‡½æ•°ï¼Œå¹¶å¯¹å­èŠ‚ç‚¹é€’å½’æ‰§è¡Œã€‚</p>
</li>
<li><p><code>TRS</code>ç±»ä½¿ç”¨å››å…ƒæ•°è¿›è¡Œæ—‹è½¬</p>
<p>æˆ‘ä»¬å¹¶æ²¡æœ‰ä»‹ç»è¿‡å››å…ƒæ•°ï¼Œè¯´å®è¯æˆ‘ä¸è®¤ä¸ºæˆ‘éå¸¸ç†è§£è¶³ä»¥è§£é‡Šä»–ä»¬ã€‚å¹¸è¿çš„æ˜¯ï¼Œæˆ‘ä»¬ç”¨å®ƒä»¬å¹¶ä¸éœ€è¦çŸ¥é“ä»–ä»¬å¦‚ä½•å·¥ä½œã€‚æˆ‘ä»¬åªæ˜¯ä»gltfæ–‡ä»¶ä¸­å–å‡ºæ•°æ®ï¼Œè°ƒç”¨ä¸€ä¸ªå‡½æ•°å®ƒé€šè¿‡è¿™äº›æ•°æ®åˆ›å»ºä¸€ä¸ªçŸ©é˜µï¼Œä½¿ç”¨è¯¥çŸ©é˜µã€‚</p>
</li>
</ul>
<p>glTFæ–‡ä»¶ä¸­çš„èŠ‚ç‚¹æ•°æ®å­˜å‚¨ä¸ºæ•°ç»„ã€‚
æˆ‘ä»¬ä¼šè½¬æ¢glTFæ–‡ä»¶ä¸­çš„èŠ‚ç‚¹æ•°æ®ä¸º<code>Node</code>å®ä¾‹ã€‚æˆ‘ä»¬å­˜å‚¨èŠ‚ç‚¹æ•°æ®çš„æ—§æ•°ç»„ä¸º<code>origNodes</code>ï¼Œæˆ‘ä»¬ç¨åä¼šéœ€è¦ç”¨å®ƒã€‚</p>
<pre class="prettyprint"><code>const origNodes = gltf.nodes;
gltf.nodes = gltf.nodes.map((n) =&gt; {
  const {name, skin, mesh, translation, rotation, scale} = n;
  const trs = new TRS(translation, rotation, scale);
  const node = new Node(trs, name);
  const realMesh =ã€€gltf.meshes[mesh];
  if (realMesh) {
    node.drawables.push(new MeshRenderer(realMesh));
  }
  return node;
});
</code></pre><p>ä¸Šé¢æˆ‘ä»¬ä¸ºæ¯ä¸ªèŠ‚ç‚¹åˆ›å»ºä¸€ä¸ª<code>TRS</code>å®ä¾‹ï¼Œä¸€ä¸ª<code>Node</code>å®ä¾‹ï¼Œæˆ‘ä»¬æŸ¥æ‰¾ä¹‹å‰è®¾ç½®çš„ç½‘æ ¼æ•°æ®ï¼Œå¦‚æœæœ‰<code>mesh</code>å±æ€§çš„è¯ï¼Œåˆ›å»ºä¸€ä¸ª <code>MeshRenderer</code>æ¥ç»˜åˆ¶å®ƒã€‚</p>
<p>è®©æˆ‘ä»¬æ¥åˆ›å»º<code>MeshRenderer</code>ã€‚å®ƒåªæ˜¯<a href="webgl-less-code-more-fun.html">ç å°‘è¶£å¤š</a>æ–‡ç« ä¸­æ¸²æŸ“å•ä¸ªæ¨¡å‹ä»£ç çš„å°è£…ã€‚å®ƒæ‰€åšçš„å°±æ˜¯å­˜ä¸€ä¸ªå¯¹äºç½‘æ ¼çš„å¼•ç”¨ï¼Œç„¶åä¸ºæ¯ä¸ªå›¾å…ƒè®¾ç½®ç¨‹åºï¼Œå±æ€§å’Œå…¨å±€å˜é‡ï¼Œæœ€ç»ˆé€šè¿‡<code>webglUtils.drawBufferInfo</code>è°ƒç”¨<code>gl.drawArrays</code>æˆ–è€… <code>gl.drawElements</code>;</p>
<pre class="prettyprint"><code>class MeshRenderer {
  constructor(mesh) {
    this.mesh = mesh;
  }
  render(node, projection, view, sharedUniforms) {
    const {mesh} = this;
    gl.useProgram(meshProgramInfo.program);
    for (const primitive of mesh.primitives) {
      webglUtils.setBuffersAndAttributes(gl, meshProgramInfo, primitive.bufferInfo);
      webglUtils.setUniforms(meshProgramInfo, {
        u_projection: projection,
        u_view: view,
        u_world: node.worldMatrix,
      });
      webglUtils.setUniforms(skinProgramInfo, primitive.material.uniforms);
      webglUtils.setUniforms(skinProgramInfo, sharedUniforms);
      webglUtils.drawBufferInfo(gl, primitive.bufferInfo);
    }
  }
}
</code></pre><p>æˆ‘ä»¬å·²ç»åˆ›å»ºäº†èŠ‚ç‚¹ï¼Œç°åœ¨æˆ‘ä»¬éœ€è¦å°†å®ƒä»¬å®é™…å®‰æ’åˆ°åœºæ™¯å›¾ä¸­ã€‚åœ¨glTFä¸­2æ­¥å®Œæˆã€‚
é¦–å…ˆï¼Œæ¯ä¸ªèŠ‚ç‚¹æœ‰ä¸€ä¸ªå¯é€‰çš„childrenå±æ€§ï¼Œä¸ºå­èŠ‚ç‚¹çš„ä¸‹æ ‡æ•°ç»„ï¼Œæ‰€ä»¥æˆ‘ä»¬å¯ä»¥éå†æ‰€æœ‰èŠ‚ç‚¹ä¸ºå®ƒä»¬çš„å­èŠ‚ç‚¹è®¾å®šçˆ¶èŠ‚ç‚¹ã€‚</p>
<pre class="prettyprint"><code>function addChildren(nodes, node, childIndices) {
  childIndices.forEach((childNdx) =&gt; {
    const child = nodes[childNdx];
    child.setParent(node);
  });
}

// å°†èŠ‚ç‚¹åŠ å…¥åœºæ™¯å›¾
gltf.nodes.forEach((node, ndx) =&gt; {
  const children = origNodes[ndx].children;
  if (children) {
    addChildren(gltf.nodes, node, children);
  }
});
</code></pre><p>ç„¶åæœ‰ä¸€ä¸ªåœºæ™¯çš„æ•°ç»„ã€‚ä¸€ä¸ªåœºæ™¯æœ‰ä¸€ä¸ªåœºæ™¯åº•éƒ¨èŠ‚ç‚¹åœ¨nodesæ•°ç»„ä¸­ä¸‹æ ‡çš„æ•°ç»„æ¥å¼•ç”¨è¿™äº›èŠ‚ç‚¹ã€‚æˆ‘ä¸æ˜¯å¾ˆæ¸…æ¥šä¸ºä»€ä¹ˆä¸ç®€å•åœ°ä»å•ä¸ªæ ¹èŠ‚ç‚¹å¼€å§‹ï¼Œä½†æ˜¯æ— è®ºå¦‚ä½•è¿™å°±æ˜¯glTFæ–‡ä»¶ä¸­åœ°å†…å®¹ã€‚æ‰€ä»¥æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªæ ¹èŠ‚ç‚¹ï¼Œä½œä¸ºæ‰€æœ‰åœºæ™¯å­èŠ‚ç‚¹çš„çˆ¶èŠ‚ç‚¹ã€‚</p>
<pre class="prettyprint"><code>  // è®¾ç½®åœºæ™¯
  for (const scene of gltf.scenes) {
    scene.root = new Node(new TRS(), scene.name);
    addChildren(gltf.nodes, scene.root, scene.nodes);
  }

  return gltf;
}
</code></pre><p>æˆ‘ä»¬å·²ç»å®Œæˆäº†åŠ è½½ï¼Œè‡³å°‘åªæ˜¯ç½‘æ ¼éƒ¨åˆ†ã€‚è®©æˆ‘ä»¬å°†ä¸»å‡½æ•°æ ‡è®°ä¸º<code>async</code> æ‰€ä»¥æˆ‘ä»¬èƒ½ä½¿ç”¨<code>await</code>å…³é”®å­—ã€‚</p>
<pre class="prettyprint"><code>async function main() {
</code></pre><p>æˆ‘ä»¬å¯ä»¥åƒè¿™æ ·åŠ è½½gltfæ–‡ä»¶</p>
<pre class="prettyprint"><code>const gltf = await loadGLTF(&#39;resources/models/killer_whale/whale.CYCLES.gltf&#39;);
</code></pre><p>æˆ‘ä»¬éœ€è¦ä¸€ä¸ªä¸gltfæ–‡ä»¶ä¸­çš„æ•°æ®åŒ¹é…çš„ç€è‰²å™¨ã€‚è®©æˆ‘ä»¬çœ‹çœ‹gltfæ–‡ä»¶ä¸­çš„å›¾å…ƒæ•°æ®ã€‚</p>
<pre class="prettyprint"><code>{
    &quot;name&quot; : &quot;orca&quot;,
    &quot;primitives&quot; : [
        {
            &quot;attributes&quot; : {
                &quot;JOINTS_0&quot; : 5,
                &quot;NORMAL&quot; : 2,
                &quot;POSITION&quot; : 1,
                &quot;TANGENT&quot; : 3,
                &quot;TEXCOORD_0&quot; : 4,
                &quot;WEIGHTS_0&quot; : 6
            },
            &quot;indices&quot; : 0
        }
    ]
}
</code></pre><p>çœ‹ä¸€ä¸‹ï¼Œæˆ‘ä»¬åªä½¿ç”¨<code>NORMAL</code>å’Œ<code>POSITION</code>æ¥æ¸²æŸ“ã€‚æˆ‘ä»¬åœ¨æ¯ä¸ªå±æ€§å‰æ·»åŠ äº†<code>a_</code>ï¼Œå› æ­¤åƒè¿™æ ·çš„é¡¶ç‚¹ç€è‰²å™¨åº”è¯¥å¯ä»¥å·¥ä½œã€‚ </p>
<pre class="prettyprint"><code>attribute vec4 a_POSITION;
attribute vec3 a_NORMAL;

uniform mat4 u_projection;
uniform mat4 u_view;
uniform mat4 u_world;

varying vec3 v_normal;

void main() {
  gl_Position = u_projection * u_view * u_world * a_POSITION;
  v_normal = mat3(u_world) * a_NORMAL;
}
</code></pre><p>ç‰‡æ–­ç€è‰²å™¨ä¸­æˆ‘ä»¬ä½¿ç”¨ä¸€ä¸ªç®€å•çš„å¹³è¡Œå…‰</p>
<pre class="prettyprint"><code>precision mediump float;

varying vec3 v_normal;

uniform vec4 u_diffuse;
uniform vec3 u_lightDirection;

void main () {
  vec3 normal = normalize(v_normal);
  float light = dot(u_lightDirection, normal) * .5 + .5;
  gl_FragColor = vec4(u_diffuse.rgb * light, u_diffuse.a);
}
</code></pre><p>æ³¨æ„æˆ‘ä»¬ä½¿ç”¨äº†<a href="webgl-3d-lighting-directional.html">å¹³è¡Œå…‰</a>æ–‡ç« ä¸­æåˆ°çš„ç‚¹ä¹˜ï¼Œä½†ä¸æ­¤ä¸åŒï¼Œè¿™é‡Œç‚¹ä¹˜ç»“æœä¹˜ä»¥.5å¹¶åŠ ä¸Š.5ã€‚æ­£å¸¸å¹³è¡Œå…‰ç…§ï¼Œå½“ç›´æ¥é¢å‘å…‰æºæ—¶ï¼Œè¡¨é¢100%ç…§äº®ï¼Œå‡å¼±åˆ°0%å½“è¡¨é¢æ–¹å‘å’Œå…‰ç…§å‚ç›´ã€‚è¿™æ„å‘³ç€è¿œç¦»å…‰çº¿çš„æ¨¡å‹çš„1/2æ˜¯é»‘çš„ã€‚é€šè¿‡ä¹˜ä»¥.5å¹¶åŠ ä¸Š.5ï¼Œæˆ‘ä»¬å°†ç‚¹ä¹˜ä»-1 &lt;-&gt; 1è½¬æ¢åˆ°0 &lt;-&gt; 1ï¼Œè¿™æ„å‘³ç€å½“å®Œå…¨åæ–¹å‘æ—¶æ‰ä¼šæ˜¯é»‘è‰²ã€‚è¿™ä¸ºç®€å•æµ‹è¯•æä¾›äº†ç®€å•å¹¶å¾ˆå¥½çš„ç…§æ˜ã€‚</p>
<p>æ‰€ä»¥ï¼Œæˆ‘ä»¬éœ€è¦ç¼–è¯‘å’Œè¿æ¥ç€è‰²å™¨</p>
<pre class="prettyprint"><code>// ç¼–è¯‘å’Œè¿æ¥ç€è‰²å™¨ï¼ŒæŸ¥æ‰¾å±æ€§å’Œå…¨å±€å˜é‡çš„ä½ç½®
const meshProgramInfo = webglUtils.createProgramInfo(gl, [&quot;meshVS&quot;, &quot;fs&quot;]);
</code></pre><p>æ¥ç€æ¸²æŸ“ï¼Œæ‰€æœ‰å’Œä¹‹å‰ä¸åŒçš„åœ°æ–¹æ˜¯</p>
<pre class="prettyprint"><code>const sharedUniforms = {
  u_lightDirection: m4.normalize([-1, 3, 5]),
};

function renderDrawables(node) {
  for(const drawable of node.drawables) {
      drawable.render(node, projection, view, sharedUniforms);
  }
}

for (const scene of gltf.scenes) {
  // æ›´æ–°åœºæ™¯ä¸­çš„ä¸–ç•ŒçŸ©é˜µã€‚
  scene.root.updateWorldMatrix();
  // éå†åœºæ™¯å¹¶æ¸²æŸ“æ‰€æœ‰renderables
  scene.root.traverse(renderDrawables);
}
</code></pre><p>ä¹‹å‰é—ç•™ä¸‹æ¥çš„(æœªåœ¨ä¸Šé¢æ˜¾ç¤º)æ˜¯ç”¨äºè®¡ç®—æŠ•å½±çŸ©é˜µï¼Œç›¸æœºçŸ©é˜µï¼Œå’Œè§†å›¾çŸ©é˜µçš„ä»£ç ã€‚æ¥ä¸‹æ¥æˆ‘ä»¬éå†æ¯ä¸ªåœºæ™¯ï¼Œè°ƒç”¨<code>scene.root.updateWorldMatrix</code>ä¼šæ›´æ–°åœºæ™¯å›¾ä¸­æ‰€æœ‰èŠ‚ç‚¹çš„çŸ©é˜µã€‚ç„¶åæˆ‘ä»¬ä¸º<code>renderDrawables</code>è°ƒç”¨<code>scene.root.traverse</code>ã€‚</p>
<p><code>renderDrawables</code>è°ƒç”¨è¯¥èŠ‚ç‚¹ä¸Šæ‰€æœ‰ç»˜åˆ¶å¯¹è±¡çš„æ¸²æŸ“æ–¹æ³•ï¼Œä¼ å…¥æŠ•å½±ï¼Œè§†å›¾çŸ©é˜µï¼Œ<code>sharedUniforms</code>åŒ…å«çš„å…‰ç…§ä¿¡æ¯ã€‚</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-skinning-3d-gltf.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-skinning-3d-gltf.html" target="_blank">ç‚¹æ­¤åœ¨æ–°çª—å£ä¸­æµè§ˆ</a>
</div>

</p>
<p>ç°åœ¨ï¼Œè¿™æ˜¯æˆ‘ä»¬å¤„ç†è’™çš®çš„å·¥ä½œã€‚</p>
<p>é¦–å…ˆè®©æˆ‘ä»¬åˆ›å»ºä¸€ä¸ªä»£è¡¨è’™çš®çš„ç±»ã€‚å®ƒå°†ç®¡ç†å…³èŠ‚åˆ—è¡¨ï¼Œå…³èŠ‚æ˜¯åº”ç”¨äºè’™çš®çš„åœºæ™¯å›¾ä¸­èŠ‚ç‚¹çš„å¦ä¸€ä¸ªåå­—ã€‚å®ƒè¿˜ä¼šæœ‰ç»‘å®šçŸ©é˜µçš„é€†çŸ©é˜µã€‚å®ƒä¼šç®¡ç†æˆ‘ä»¬æ”¾å…¥å…³èŠ‚çŸ©é˜µçš„æè´¨ã€‚</p>
<pre class="prettyprint"><code>class Skin {
  constructor(joints, inverseBindMatrixData) {
    this.joints = joints;
    this.inverseBindMatrices = [];
    this.jointMatrices = [];
    // ä¸ºæ¯ä¸ªå…³èŠ‚çŸ©é˜µåˆ†é…è¶³å¤Ÿçš„ç©ºé—´
    this.jointData = new Float32Array(joints.length * 16);
    // ä¸ºæ¯ä¸ªå…³èŠ‚å’Œç»‘å®šé€†çŸ©é˜µåˆ›å»ºè§†å›¾
    for (let i = 0; i &lt; joints.length; ++i) {
      this.inverseBindMatrices.push(new Float32Array(
          inverseBindMatrixData.buffer,
          inverseBindMatrixData.byteOffset + Float32Array.BYTES_PER_ELEMENT * 16 * i,
          16));
      this.jointMatrices.push(new Float32Array(
          this.jointData.buffer,
          Float32Array.BYTES_PER_ELEMENT * 16 * i,
          16));
    }
    // åˆ›å»ºå­˜å‚¨å…³èŠ‚çŸ©é˜µçš„çº¹ç†
    this.jointTexture = gl.createTexture();
    gl.bindTexture(gl.TEXTURE_2D, this.jointTexture);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.CLAMP_TO_EDGE);
    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.CLAMP_TO_EDGE);
  }
  update(node) {
    const globalWorldInverse = m4.inverse(node.worldMatrix);
    // éå†æ¯ä¸ªå…³èŠ‚è·å¾—å½“å‰ä¸–ç•ŒçŸ©é˜µ
    // æ¥è®¡ç®—ç»‘å®šçŸ©é˜µçš„é€† 
    // å¹¶åœ¨çº¹ç†ä¸­å­˜å‚¨æ•´ä¸ªç»“æœ
    for (let j = 0; j &lt; this.joints.length; ++j) {
      const joint = this.joints[j];
      const dst = this.jointMatrices[j];
      m4.multiply(globalWorldInverse, joint.worldMatrix, dst);
      m4.multiply(dst, this.inverseBindMatrices[j], dst);
    }
    gl.bindTexture(gl.TEXTURE_2D, this.jointTexture);
    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, 4, this.joints.length, 0,
                  gl.RGBA, gl.FLOAT, this.jointData);
  }
}
</code></pre><p>åƒ<code>MeshRenderer</code>ä¸€æ ·ï¼Œæˆ‘ä»¬åˆ¶ä½œ<code>SkinRenderer</code>ï¼Œæ¥ç”¨<code>Skin</code>æ¥æ¸²æŸ“è’™çš®ç½‘æ ¼ã€‚</p>
<pre class="prettyprint"><code>class SkinRenderer {
  constructor(mesh, skin) {
    this.mesh = mesh;
    this.skin = skin;
  }
  render(node, projection, view, sharedUniforms) {
    const {skin, mesh} = this;
    skin.update(node);
    gl.useProgram(skinProgramInfo.program);
    for (const primitive of mesh.primitives) {
      webglUtils.setBuffersAndAttributes(gl, skinProgramInfo, primitive.bufferInfo);
      webglUtils.setUniforms(skinProgramInfo, {
        u_projection: projection,
        u_view: view,
        u_world: node.worldMatrix,
        u_jointTexture: skin.jointTexture,
        u_numJoints: skin.joints.length,
      });
      webglUtils.setUniforms(skinProgramInfo, primitive.material.uniforms);
      webglUtils.setUniforms(skinProgramInfo, sharedUniforms);
      webglUtils.drawBufferInfo(gl, primitive.bufferInfo);
    }
  }
}
</code></pre><p>ä½ å¯ä»¥çœ‹åˆ°å’Œ <code>MeshRenderer</code>éå¸¸ç±»ä¼¼ã€‚å®ƒæœ‰ä¸€ä¸ª<code>Skin</code>çš„å¼•ç”¨æ¥æ›´æ–°æ‰€æœ‰æ¸²æŸ“éœ€è¦çš„çŸ©é˜µã€‚ç„¶åå®ƒåè·Ÿäº†æ¸²æŸ“çš„æ ‡å‡†æ¨¡å¼ï¼Œä½¿ç”¨ç¨‹åºï¼Œè®¾ç½®å±æ€§ï¼Œç”¨<code>webglUtils.setUniforms</code>è®¾ç½®å…¨å±€å˜é‡ï¼Œä¹Ÿç»‘å®šçº¹ç†ï¼Œç„¶åæ¸²æŸ“ã€‚</p>
<p>æˆ‘ä»¬ä¹Ÿéœ€è¦ä¸€ä¸ªæ”¯æŒè’™çš®çš„é¡¶ç‚¹ç€è‰²å™¨</p>
<pre class="prettyprint"><code>&lt;script id=&quot;skinVS&quot; type=&quot;notjs&quot;&gt;
attribute vec4 a_POSITION;
attribute vec3 a_NORMAL;
attribute vec4 a_WEIGHTS_0;
attribute vec4 a_JOINTS_0;

uniform mat4 u_projection;
uniform mat4 u_view;
uniform mat4 u_world;
uniform sampler2D u_jointTexture;
uniform float u_numJoints;

varying vec3 v_normal;

// è¿™äº›åç§»å‡è®¾çº¹ç†æ¯è¡Œ4ä¸ªåƒç´ 
#define ROW0_U ((0.5 + 0.0) / 4.)
#define ROW1_U ((0.5 + 1.0) / 4.)
#define ROW2_U ((0.5 + 2.0) / 4.)
#define ROW3_U ((0.5 + 3.0) / 4.)

mat4 getBoneMatrix(float jointNdx) {
  float v = (jointNdx + 0.5) / u_numJoints;
  return mat4(
    texture2D(u_jointTexture, vec2(ROW0_U, v)),
    texture2D(u_jointTexture, vec2(ROW1_U, v)),
    texture2D(u_jointTexture, vec2(ROW2_U, v)),
    texture2D(u_jointTexture, vec2(ROW3_U, v)));
}

void main() {
  mat4 skinMatrix = getBoneMatrix(a_JOINTS_0[0]) * a_WEIGHTS_0[0] +
                    getBoneMatrix(a_JOINTS_0[1]) * a_WEIGHTS_0[1] +
                    getBoneMatrix(a_JOINTS_0[2]) * a_WEIGHTS_0[2] +
                    getBoneMatrix(a_JOINTS_0[3]) * a_WEIGHTS_0[3];
  mat4 world = u_world * skinMatrix;
  gl_Position = u_projection * u_view * world * a_POSITION;
  v_normal = mat3(world) * a_NORMAL;
}
&lt;/script&gt;
</code></pre><p>è¿™ä¸æˆ‘ä»¬ä¹‹å‰ä»‹ç»çš„è’™çš®ç€è‰²å™¨å‡ ä¹ç›¸åŒã€‚æˆ‘ä»¬é‡å‘½åäº†å±æ€§å€¼æ¥åŒ¹é…gltfæ–‡ä»¶ä¸­çš„å†…å®¹ã€‚æœ€å¤§çš„ä¸åŒæ˜¯æˆ‘ä»¬ç”Ÿæˆäº†ä¸€ä¸ª <code>skinMatrix</code>ã€‚åœ¨æˆ‘ä»¬ä¹‹å‰çš„è’™çš®ç€è‰²å™¨ï¼Œæˆ‘ä»¬å°†ä½ç½®å’Œæ¯ä¸€ä¸ªå…³èŠ‚ï¼éª¨éª¼çŸ©é˜µç›¸ä¹˜ï¼Œå¹¶ä¹˜ä»¥æ¯ä¸ªå…³èŠ‚çš„å½±å“æƒé‡ã€‚åœ¨è¿™ä¸ªä¾‹å­ä¸­ï¼Œæˆ‘ä»¬ä»£æ›¿çš„å°†çŸ©é˜µå’Œæƒé‡ç›¸ä¹˜å¹¶ç›¸åŠ ï¼Œåªä¹˜ä»¥ä¸€æ¬¡ä½ç½®ã€‚è¿™äº§ç”Ÿç›¸åŒçš„ç»“æœï¼Œä½†æ˜¯æˆ‘ä»¬å¯ä»¥ä½¿ç”¨<code>skinMatrix</code>å’Œæ³•çº¿ç›¸ä¹˜ï¼Œæˆ‘ä»¬éœ€è¦è¿™æ ·åšå¦åˆ™æ³•çº¿ä¼šå’Œè’™çš®ä¸åŒ¹é…ã€‚</p>
<p>è¿˜è¦æ³¨æ„åœ¨è¿™é‡Œæˆ‘ä»¬ç”¨<code>u_world</code>ç›¸ä¹˜ã€‚æˆ‘ä»¬åœ¨<code>Skin.update</code>é‡Œå‡å»äº†å®ƒã€‚</p>
<pre class="prettyprint"><code>*const globalWorldInverse = m4.inverse(node.worldMatrix);
// éå†æ¯ä¸ªå…³èŠ‚ï¼Œè·å¾—å®ƒå½“å‰çš„ä¸–ç•ŒçŸ©é˜µ 
// æ¥è®¡ç®—ç»‘å®šçŸ©é˜µçš„é€†
// å¹¶åœ¨çº¹ç†ä¸­å­˜å‚¨æ•´ä¸ªç»“æœ
for (let j = 0; j &lt; this.joints.length; ++j) {
  const joint = this.joints[j];
  const dst = this.jointMatrices[j];
*  m4.multiply(globalWorldInverse, joint.worldMatrix, dst);
</code></pre><p>æ— è®ºä½ æ˜¯å¦è¿™æ ·åšå–å†³äºä½ ã€‚è¿™æ ·åšçš„åŸå› æ˜¯å®ƒå…è®¸ä½ å®ä¾‹åŒ–è’™çš®ã€‚æ¢å¥è¯è¯´ä½ å¯ä»¥åœ¨ç›¸åŒå¸§ä¸­åœ¨ä¸åŒçš„åœ°æ–¹æ¸²æŸ“è’™çš®ç½‘æ ¼ã€‚å¦‚æœæœ‰å¾ˆå¤šçš„å…³èŠ‚ï¼Œå¯¹äºä¸€ä¸ªè’™çš®ç½‘æ ¼åšæ‰€æœ‰çš„çŸ©é˜µæ•°å­¦æ˜¯éå¸¸æ…¢çš„ï¼Œæ‰€ä»¥ä½ åšä¸€éæ•°å­¦æ“ä½œï¼Œç„¶åä½ å¯ä»¥é€šè¿‡ä¸€ä¸ªä¸åŒçš„ä¸–ç•ŒçŸ©é˜µå°†è’™çš®ç½‘æ ¼é‡æ¸²æŸ“åœ¨ä»»ä½•åœ°æ–¹ã€‚ </p>
<p>è¿™å¯¹äºæ˜¾ç¤ºä¸€ç¾¤è§’è‰²æ˜¯æœ‰æ•ˆçš„ã€‚ä¸å¹¸çš„æ˜¯æ‰€æœ‰çš„è§’è‰²éƒ½ä¼šæ˜¯ç›¸åŒçš„å§¿åŠ¿ï¼Œæ‰€ä»¥æˆ‘å¹¶ä¸æ¸…æ¥šè¿™æ˜¯å¦æœ‰ç”¨ã€‚è¿™ç§æƒ…å†µé€šå¸¸å‡ºç°çš„é¢‘ç‡æ˜¯å¤šå°‘? ä½ å¯ä»¥åœ¨<code>Skin</code>ä¸­ç§»é™¤ä¹˜ä»¥ä¸–ç•ŒçŸ©é˜µçš„é€†å¹¶åœ¨ç€è‰²å™¨ä¸­ç§»é™¤ä¹˜ä»¥<code>u_world</code>ï¼Œç»“æœæ˜¯ä¸€æ ·çš„ï¼Œä½ ä»…ä»…ä¸èƒ½<em>å®ä¾‹åŒ–</em> é‚£ä¸ªè’™çš®ç½‘æ ¼ã€‚å½“ç„¶ä½ å¯ä»¥å¤šæ¬¡æ¸²æŸ“ä¸åŒå§¿åŠ¿çš„åŒä¸€è’™çš®ç½‘æ ¼ã€‚ä½ ä¼šéœ€è¦ä¸€ä¸ªä¸åŒçš„<code>Skin</code>å¯¹è±¡æŒ‡å‘å…¶ä»–æ–¹å‘çš„ä¸åŒèŠ‚ç‚¹ã€‚</p>
<p>å›åˆ°æˆ‘ä»¬çš„åŠ è½½ä»£ç ï¼Œå½“æˆ‘ä»¬åˆ›å»º<code>Node</code>å®ä¾‹æ—¶ï¼Œå¦‚æœæœ‰<code>skin</code>å±æ€§ï¼Œæˆ‘ä»¬è®°å½•å®ƒï¼Œä¸ºäº†èƒ½ä¸ºå®ƒåˆ›å»ºä¸€ä¸ª<code>Skin</code>ã€‚</p>
<pre class="prettyprint"><code>+const skinNodes = [];
const origNodes = gltf.nodes;
gltf.nodes = gltf.nodes.map((n) =&gt; {
  const {name, skin, mesh, translation, rotation, scale} = n;
  const trs = new TRS(translation, rotation, scale);
  const node = new Node(trs, name);
  const realMesh =ã€€gltf.meshes[mesh];
+  if (skin !== undefined) {
+    skinNodes.push({node, mesh: realMesh, skinNdx: skin});
+  } else if (realMesh) {
    node.drawables.push(new MeshRenderer(realMesh));
  }
  return node;
});
</code></pre><p>åˆ›å»º<code>Node</code>ä¹‹åæˆ‘ä»¬éœ€è¦åˆ›å»º<code>Skin</code>ã€‚è’™çš®é€šè¿‡<code>joints</code>æ•°ç»„å¼•ç”¨èŠ‚ç‚¹ï¼Œè¯¥æ•°ç»„æ˜¯ä¸ºå…³èŠ‚æä¾›çŸ©é˜µçš„èŠ‚ç‚¹ä¸‹æ ‡æ•°ç»„ã€‚
è’™çš®ä¹Ÿå¼•ç”¨ä¸€ä¸ªè®¿é—®å™¨ï¼Œè®¿é—®å™¨å¼•ç”¨äº†ä¿å­˜åœ¨æ–‡ä»¶ä¸­çš„åå‘ç»‘å®šå§¿åŠ¿çŸ©é˜µã€‚</p>
<pre class="prettyprint"><code>// è®¾ç½®è’™çš®
gltf.skins = gltf.skins.map((skin) =&gt; {
  const joints = skin.joints.map(ndx =&gt; gltf.nodes[ndx]);
  const {stride, array} = getAccessorTypedArrayAndStride(gl, gltf, skin.inverseBindMatrices);
  return new Skin(joints, array);
});
</code></pre><p>ä¸Šé¢çš„ä»£ç ç»™å®šä¸€ä¸ªè®¿é—®å™¨ä¸‹æ ‡ï¼Œè°ƒç”¨äº†<code>getAccessorTypedArrayAndStride</code>ã€‚æˆ‘ä»¬éœ€è¦æä¾›è¿™éƒ¨åˆ†çš„ä»£ç ã€‚ç»™å®šä¸€ä¸ªè®¿é—®å™¨ï¼Œæˆ‘ä»¬ä¼šè¿”å›<a href="https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/TypedArray">ç±»å‹åŒ–æ•°ç»„</a>çš„æ­£ç¡®ç±»å‹è§†å›¾ä»¥è®¿é—®ç¼“å†²ä¸­çš„æ•°æ®ã€‚</p>
<pre class="prettyprint"><code>const glTypeToTypedArrayMap = {
  &#39;5120&#39;: Int8Array,    // gl.BYTE
  &#39;5121&#39;: Uint8Array,   // gl.UNSIGNED_BYTE
  &#39;5122&#39;: Int16Array,   // gl.SHORT
  &#39;5123&#39;: Uint16Array,  // gl.UNSIGNED_SHORT
  &#39;5124&#39;: Int32Array,   // gl.INT
  &#39;5125&#39;: Uint32Array,  // gl.UNSIGNED_INT
  &#39;5126&#39;: Float32Array, // gl.FLOAT
}

// ç»™å®šä¸€ä¸ªGLç±»å‹è¿”å›éœ€è¦çš„ç±»å‹
function glTypeToTypedArray(type) {
  return glTypeToTypedArrayMap[type] || throwNoKey(type);
}

// ç»™å®šä¸€ä¸ªè®¿é—®å™¨ä¸‹æ ‡è¿”å›è®¿é—®å™¨
// å’Œç¼“å†²æ­£ç¡®éƒ¨åˆ†çš„ç±»å‹åŒ–æ•°ç»„
function getAccessorTypedArrayAndStride(gl, gltf, accessorIndex) {
  const accessor = gltf.accessors[accessorIndex];
  const bufferView = gltf.bufferViews[accessor.bufferView];
  const TypedArray = glTypeToTypedArray(accessor.componentType);
  const buffer = gltf.buffers[bufferView.buffer];
  return {
    accessor,
    array: new TypedArray(
        buffer,
        bufferView.byteOffset + (accessor.byteOffset || 0),
        accessor.count * accessorTypeToNumComponents(accessor.type)),
    stride: bufferView.byteStride || 0,
  };
}
</code></pre><p>éœ€è¦æ³¨æ„çš„æ˜¯ä¸Šé¢çš„ä»£ç æˆ‘ä»¬ç”¨ç¡¬ç¼–ç çš„WebGLå¸¸é‡åˆ¶ä½œäº†ä¸€ä¸ªè¡¨ã€‚è¿™æ˜¯æˆ‘ä»¬ç¬¬ä¸€æ¬¡è¿™æ ·åšã€‚å¸¸é‡ä¸ä¼šæ”¹å˜ï¼Œæ‰€ä»¥è¿™æ˜¯å®‰å…¨çš„ã€‚</p>
<p>ç°åœ¨æˆ‘ä»¬æœ‰äº†è’™çš®ï¼Œæˆ‘ä»¬å¯ä»¥è¿”å›å¹¶å°†å®ƒé—¨æ·»åŠ åˆ°å¼•ç”¨å®ƒä»¬çš„èŠ‚ç‚¹ã€‚</p>
<pre class="prettyprint"><code>// ç»™è’™çš®èŠ‚ç‚¹æ·»åŠ SkinRenderers
for (const {node, mesh, skinNdx} of skinNodes) {
  node.drawables.push(new SkinRenderer(mesh, gltf.skins[skinNdx]));
}
</code></pre><p>å¦‚æœæˆ‘ä»¬è¿™æ ·æ¸²æŸ“æˆ‘ä»¬çœ‹ä¸å‡ºä»»ä½•ä¸åŒã€‚æˆ‘ä»¬éœ€è¦è®©ä¸€äº›èŠ‚ç‚¹åŠ¨èµ·æ¥ã€‚è®©æˆ‘ä»¬éå†<code>Skin</code>ä¸­çš„æ¯ä¸ªèŠ‚ç‚¹ï¼Œæ¢å¥è¯è¯´æ¯ä¸ªå…³èŠ‚ï¼Œå¹¶åœ¨æœ¬åœ°xè½´ä¸Šæ—‹è½¬ä¸€ç‚¹ç‚¹ã€‚</p>
<p>ä¸ºæ­¤ï¼Œæˆ‘ä»¬ä¼šå­˜æ¯ä¸ªå…³èŠ‚çš„åŸå§‹æœ¬åœ°çŸ©é˜µã€‚æˆ‘ä»¬ä¼šæ¯å¸§æ—‹è½¬ä¸€äº›æœ¬åœ°çŸ©é˜µï¼Œä½¿ç”¨ä¸€ä¸ªç‰¹æ®Šçš„æ–¹æ³•<code>m4.decompose</code>ï¼Œä¼šè½¬æ¢çŸ©é˜µä¸ºå…³èŠ‚çš„ä½ç½®ï¼Œæ—‹è½¬é‡ï¼Œç¼©æ”¾é‡ã€‚</p>
<pre class="prettyprint"><code>const origMatrix = new Map();
function animSkin(skin, a) {
  for(let i = 0; i &lt; skin.joints.length; ++i) {
    const joint = skin.joints[i];
    // å¦‚æœè¿™ä¸ªå…³èŠ‚å¹¶æ²¡æœ‰å­˜å‚¨çŸ©é˜µ
    if (!origMatrix.has(joint)) {
      // ä¸ºå…³èŠ‚å­˜å‚¨ä¸€ä¸ªçŸ©é˜µ
      origMatrix.set(joint, joint.source.getMatrix());
    }
    // è·å–åŸå§‹çš„çŸ©é˜µ
    const origMatrix = origRotations.get(joint);
    // æ—‹è½¬å®ƒ
    const m = m4.xRotate(origMatrix, a);
    // åˆ†è§£å›å…³èŠ‚çš„ä½ç½®ï¼Œæ—‹è½¬é‡ï¼Œç¼©æ”¾é‡
    m4.decompose(m, joint.source.position, joint.source.rotation, joint.source.scale);
  }
}
</code></pre><p>ç„¶ååœ¨æ¸²æŸ“ä¹‹å‰æˆ‘ä»¬ä¼šè°ƒç”¨å®ƒ</p>
<pre class="prettyprint"><code>animSkin(gltf.skins[0], Math.sin(time) * .5);
</code></pre><p>æ³¨æ„<code>animSkin</code>ä¸æ˜¯é€šå¸¸çš„åšæ³•ã€‚ç†æƒ³æƒ…å†µä¸‹ï¼Œæˆ‘ä»¬ä¼šåŠ è½½ä¸€äº›è‰ºæœ¯å®¶åˆ¶ä½œçš„åŠ¨ç”»æˆ–è€…æˆ‘ä»¬çŸ¥é“æˆ‘ä»¬æƒ³è¦ä»¥æŸç§æ–¹å¼åœ¨ä»£ç ä¸­æ“ä½œæŸä¸ªç‰¹å®šå…³èŠ‚ã€‚åœ¨è¿™ä¸ªä¾‹å­é‡Œï¼Œæˆ‘ä»¬åªæ˜¯çœ‹çœ‹è’™çš®æ˜¯å¦æœ‰æ•ˆï¼Œè¿™ä¼¼ä¹æ˜¯ä¸€ç§ç®€å•çš„æ–¹æ³•ã€‚</p>
<p><div class="webgl_example_container">
  <iframe class="webgl_example" style=" " src="/webgl/resources/editor.html?url=/webgl/lessons/..%2Fwebgl-skinning-3d-gltf-skinned.html"></iframe>
  <a class="webgl_center" href="/webgl/lessons/../webgl-skinning-3d-gltf-skinned.html" target="_blank">ç‚¹æ­¤åœ¨æ–°çª—å£ä¸­æµè§ˆ</a>
</div>

</p>
<p>åœ¨æˆ‘ä»¬ç»§ç»­ä¹‹å‰ä¸€äº›æ³¨æ„äº‹é¡¹</p>
<p>å½“æˆ‘ç¬¬ä¸€æ¬¡å°è¯•è®©å®ƒå·¥ä½œæ—¶ï¼Œå°±åƒå¤§å¤šæ•°ç¨‹åºä¸€æ ·ï¼Œå±å¹•ä¸Šæ²¡æœ‰æ˜¾ç¤ºçš„ä¸œè¥¿ã€‚</p>
<p>æ‰€ä»¥ï¼Œé¦–å…ˆåšçš„æ˜¯åœ¨è’™çš®ç€è‰²å™¨çš„æœ«å°¾æ·»åŠ è¿™ä¸€è¡Œ </p>
<pre class="prettyprint"><code>  gl_Position = u_projection * u_view *  a_POSITION;
</code></pre><p>åœ¨ç‰‡æ–­ç€è‰²å™¨ä¸­ï¼Œæˆ‘æ”¹å˜äº†å®ƒï¼Œä»…ä»…åœ¨æœ«å°¾æ·»åŠ è¿™ä¸ªæ¥ç”»çº¯è‰²çš„</p>
<pre class="prettyprint"><code>gl_FragColor = vec4(1, 0, 0, 1);
</code></pre><p>è¿™å°†åˆ é™¤æ‰€æœ‰è’™çš®ï¼Œä»…ä»…åœ¨åŸç‚¹ç»˜åˆ¶ç½‘æ ¼ã€‚æˆ‘è°ƒæ•´ç›¸æœºä½ç½®ç›´åˆ°æˆ‘æœ‰äº†ä¸€ä¸ªå¥½çš„è§†è§’ã€‚</p>
<pre class="prettyprint"><code>const cameraPosition = [5, 0, 5];
const target = [0, 0, 0];
</code></pre><p>è¿™æ˜¾ç¤ºäº†è™é²¸çš„è½®å»“ï¼Œæ‰€ä»¥æˆ‘çŸ¥é“è‡³å°‘æœ‰ä¸€äº›æ•°æ®æ­£åœ¨å‘æŒ¥ä½œç”¨</p>
<div class="webgl_center"><img src="../resources/skinning-debug-01.png"></div>

<p>æ¥ä¸‹æ¥æˆ‘è®©ç‰‡æ–­ç€è‰²å™¨æ˜¾ç¤ºæ³•çº¿</p>
<pre class="prettyprint"><code>gl_FragColor = vec4(normalize(v_normal) * .5 + .5, 1);
</code></pre><p>æ³•çº¿ä»-1 åˆ° 1ï¼Œæ‰€ä»¥ <code>* .5 + .5</code>è°ƒæ•´å®ƒä»¬åˆ°0 åˆ° 1æ¥è§‚å¯Ÿé¢œè‰²ã€‚</p>
<p>å›åˆ°é¡¶ç‚¹ç€è‰²å™¨æˆ‘ä»…ä»…ä¼ é€’æ³•çº¿</p>
<pre class="prettyprint"><code>v_normal = a_NORMAL;
</code></pre><p>æˆ‘å¯ä»¥çœ‹åˆ°è¿™æ ·</p>
<div class="webgl_center"><img src="../resources/skinning-debug-02.png"></div>

<p>æˆ‘å¹¶æ²¡æœ‰è§‰å¾—æ³•çº¿ä¼šå‡ºé”™ï¼Œä½†æ˜¯ä»æˆ‘è®¤ä¸ºæœ‰æ•ˆçš„å¼€å§‹ï¼Œå¹¶ç¡®è®¤å®ƒç¡®å®æ˜¯æœ‰æ•ˆçš„æ˜¯å¾ˆå¥½çš„æ–¹æ³•ã€‚</p>
<p>æ¥ä¸‹æ¥æˆ‘æƒ³æˆ‘åº”è¯¥æ£€æŸ¥æƒé‡ã€‚æ‰€æœ‰æˆ‘éœ€è¦åšçš„å°±æ˜¯åƒæ³•çº¿ä¸€æ ·ä»é¡¶ç‚¹ç€è‰²å™¨ä¼ é€’æƒé‡</p>
<pre class="prettyprint"><code>v_normal = a_WEIGHTS_0.xyz * 2. - 1.;
</code></pre><p>æƒé‡ä»0åˆ°1ï¼Œä½†æ˜¯å› ä¸ºç‰‡æ–­ç€è‰²å™¨éœ€è¦æ³•çº¿ï¼Œæˆ‘ä»…ä»…æ”¹å˜æƒé‡ä»-1åˆ°1</p>
<p>è¿™æœ€åˆäº§ç”Ÿäº†ä¸€ç§æ··ä¹±çš„é¢œè‰²ã€‚ä¸€æ—¦æˆ‘å‘ç°äº†è¿™ä¸ªbugï¼Œæˆ‘å¾—åˆ°äº†è¿™æ ·çš„å›¾åƒ</p>
<div class="webgl_center"><img src="../resources/skinning-debug-03.png"></div>

<p>å®ƒå¹¶ä¸å®Œå…¨æ˜æ˜¾æ˜¯æ­£ç¡®çš„ï¼Œä½†ç¡®å®æœ‰é“ç†ã€‚ä½ å¸Œæœ›æ¯ä¸ªéª¨éª¼æœ€è¿‘çš„é¢œè‰²æœ‰å¼ºçƒˆçš„é¢œè‰²ï¼Œå¹¶ä¸”ä½ å¸Œæœ›åœ¨éª¨éª¼å‘¨å›´çœ‹åˆ°è‰²ç¯ï¼Œå› ä¸ºé‚£ä¸ªåŒºåŸŸçš„æƒé‡å¯èƒ½æ˜¯1.0æˆ–è€…è‡³å°‘å…¨éƒ¨ç›¸ä¼¼ã€‚</p>
<p>ç”±äºåŸå§‹å›¾åƒå¤ªä¹±äº†ï¼Œæˆ‘ä¹Ÿå°è¯•æ˜¾ç¤ºéª¨éª¼ä¸‹æ ‡ </p>
<pre class="prettyprint"><code>v_normal = a_JOINTS_0.xyz / (u_numJoints - 1.) * 2. - 1.;
</code></pre><p>ä¸‹æ ‡ä» 0 åˆ° éª¨éª¼æ•°é‡- 1ï¼Œæ‰€ä»¥ä¸Šè¾¹çš„ä»£ç ä¼šå¾—åˆ°-1åˆ°1çš„ç»“æœã€‚</p>
<p>å½“æ­£å¸¸å·¥ä½œæ—¶ï¼Œæˆ‘å¾—åˆ°äº†è¿™æ ·çš„å›¾åƒ</p>
<div class="webgl_center"><img src="../resources/skinning-debug-04.png"></div>

<p>åˆä¸€æ¬¡å¾—åˆ°äº†ä¹±ä¸ƒå…«ç³Ÿçš„é¢œè‰²ã€‚ä¸Šå›¾æ˜¯ä¿®å¤åçš„æ ·å­ã€‚è¿™å°±æ˜¯ä½ æœŸæœ›çœ‹åˆ°çš„è™é²¸çš„æƒé‡ã€‚æ¯ä¸ªéª¨éª¼å‘¨å›´çš„è‰²ç¯ã€‚</p>
<p>è¿™ä¸ªbugå’Œ<code>webgl.createBufferInfoFromArrays</code>å¦‚ä½•è®¡ç®—ç»„ä»¶æ•°é‡æœ‰å…³ã€‚æœ‰äº›æƒ…å†µä¸‹å®ƒè¢«å¿½ç•¥äº†ç‰¹å®šçš„é‚£ä¸ªï¼Œè¯•å›¾çŒœæµ‹ï¼Œå¹¶çŒœé”™äº†ã€‚ä¿®å¤bugåæˆ‘ç§»é™¤äº†ç€è‰²å™¨çš„æ”¹åŠ¨ã€‚æ³¨æ„å¦‚æœä½ æƒ³ä½¿ç”¨å®ƒä»¬ï¼Œæˆ‘åœ¨æ³¨é‡Šä¸­ä¿ç•™å®ƒä»¬ã€‚</p>
<p>æˆ‘æƒ³è¯´æ¸…æ¥šä¸Šé¢çš„ä»£ç æ˜¯ä¸ºäº†å¸®åŠ©è¯´æ˜è’™çš®ã€‚å®ƒå¹¶ä¸æ„å‘³æ˜¯ä¸€ä¸ªæˆç†Ÿçš„è’™çš®å¼•æ“ã€‚æˆ‘æƒ³å¦‚æœæˆ‘ä»¬è¯•å›¾åšä¸€ä¸ªå¯ä½¿ç”¨çš„å¼•æ“ï¼Œæˆ‘ä»¬ä¼šé‡åˆ°è®¸å¤šæˆ‘ä»¬å¯èƒ½éœ€è¦æ”¹å˜çš„äº‹æƒ…ï¼Œä½†æˆ‘å¸Œæœ›è¿™ä¸ªä¾‹å­å¯ä»¥å¸®åŠ©è½»å¾®æ­å¼€è’™çš®çš„ç¥ç§˜é¢çº±ã€‚</p>

    </div>
    <div class="lesson-sidebar">
        <select class="language">
    <option value="/webgl/lessons/webgl-skinning.html" >English</a>
    <option value="/webgl/lessons/fr/webgl-skinning.html" >FranÃ§ais</a>
    <option value="/webgl/lessons/ja/webgl-skinning.html" >æ—¥æœ¬èª</a>
    <option value="/webgl/lessons/ko/webgl-skinning.html" >í•œêµ­ì–´</a>
    <option value="/webgl/lessons/pl/webgl-skinning.html" >Polski</a>
    <option value="/webgl/lessons/pt-br/webgl-skinning.html" >Portuguese</a>
    <option value="/webgl/lessons/ru/webgl-skinning.html" >Ğ ÑƒÑÑĞºĞ¸Ğ¹</a>
    <option value="/webgl/lessons/zh_cn/webgl-skinning.html" selected>ç®€ä½“ä¸­æ–‡</a>
</select>


        <div id="toc">
          <ul>  <li>åŸºç¡€æ¦‚å¿µ</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-fundamentals.html">WebGL åŸºç¡€æ¦‚å¿µ</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-how-it-works.html">WebGL å·¥ä½œåŸç†</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-shaders-and-glsl.html">WebGL ç€è‰²å™¨å’ŒGLSL</a></li>
        </ul>
  <li>å›¾åƒå¤„ç†</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-image-processing.html">WebGL å›¾åƒå¤„ç†</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-image-processing-continued.html">WebGL è¿›ä¸€æ­¥å¤„ç†å›¾åƒ</a></li>
        </ul>
  <li>äºŒç»´å¹³ç§»ï¼Œæ—‹è½¬ï¼Œç¼©æ”¾å’ŒçŸ©é˜µè¿ç®—</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-2d-translation.html">WebGL äºŒç»´å¹³ç§»</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-rotation.html">WebGL äºŒç»´æ—‹è½¬</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-scale.html">WebGL äºŒç»´ç¼©æ”¾</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-matrices.html">WebGL äºŒç»´çŸ©é˜µ</a></li>
        </ul>
  <li>ä¸‰ç»´</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-orthographic.html">WebGL ä¸‰ç»´æ­£å°„æŠ•å½±</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-perspective.html">WebGL ä¸‰ç»´é€è§†æŠ•å½±</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-camera.html">WebGL ä¸‰ç»´ç›¸æœº</a></li>
        </ul>
  <li>å…‰ç…§</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-directional.html">WebGL ä¸‰ç»´æ–¹å‘å…‰æº</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-point.html">WebGL ä¸‰ç»´ç‚¹å…‰æº</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-lighting-spot.html">WebGL ä¸‰ç»´èšå…‰ç¯</a></li>
        </ul>
  <li>ç»„ç»‡å’Œé‡æ„</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-less-code-more-fun.html">WebGL ç å°‘è¶£å¤š</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-drawing-multiple-things.html">WebGL ç»˜åˆ¶å¤šä¸ªç‰©ä½“</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-scene-graph.html">WebGL åœºæ™¯å›¾</a></li>
        </ul>
  <li>å‡ ä½•</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-geometry-lathe.html">WebGL ä¸‰ç»´å‡ ä½•åŠ å·¥</a></li>
        </ul>
  <li>çº¹ç†</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-3d-textures.html">WebGL ä¸‰ç»´çº¹ç†</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-data-textures.html">WebGL æ•°æ®çº¹ç†</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2-textures.html">WebGL ä½¿ç”¨å¤šä¸ªçº¹ç†</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-cors-permission.html">WebGL è·¨åŸŸå›¾åƒ</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-3d-perspective-correct-texturemapping.html">WebGL çº¹ç†æ˜ å°„çš„é€è§†çº æ­£</a></li>
        </ul>
  <li>æ¸²æŸ“åˆ°çº¹ç†</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-render-to-texture.html">WebGL æ¸²æŸ“åˆ°çº¹ç†</a></li>
        </ul>
  <li>æŠ€æœ¯</li>
        <ul>
          <ul>  <li>äºŒç»´</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-2d-drawimage.html">WebGL äºŒç»´DrawImage</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-matrix-stack.html">WebGL äºŒç»´çŸ©é˜µæ ˆ</a></li>
        </ul>
  <li>ä¸‰ç»´</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-cube-maps.html">WebGL ç«‹æ–¹ä½“è´´å›¾</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-environment-maps.html">WebGL ç¯å¢ƒè´´å›¾</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-skybox.html">WebGL å¤©ç©ºç›’</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-skinning.html">WebGL è’™çš®</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-fog.html">WebGL é›¾</a></li>
        </ul>
  <li>æ–‡å­—</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-text-html.html">WebGL æ–‡å­— - HTML</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-text-canvas2d.html">WebGL æ–‡å­— - äºŒç»´Canvas</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-text-texture.html">WebGL æ–‡å­— - ä½¿ç”¨çº¹ç†</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-text-glyphs.html">WebGL æ–‡å­— - ä½¿ç”¨å­—å½¢çº¹ç†</a></li>
        </ul></ul>
        </ul>
  <li>Tips</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-smallest-programs.html">WebGL Smallest Programs</a></li>
        </ul>
  <li>æ‚é¡¹</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-setup-and-installation.html">WebGL è®¾ç½®å’Œå®‰è£…</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-boilerplate.html">WebGL æ ·æ¿</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-resizing-the-canvas.html">WebGL é‡ç½®ç”»å¸ƒå°ºå¯¸</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-animation.html">WebGL åŠ¨ç”»</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-and-alpha.html">WebGL å’Œé˜¿å°”æ³•é€šé“</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-2d-vs-3d-library.html">WebGL 2D vs 3D åº“</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-anti-patterns.html">WebGL é”™è¯¯æ¨¡å¼</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-matrix-vs-math.html">WebGL Matrices vs Math Matrices</a></li>
        </ul>
  <li>Reference</li>
        <ul>
          <li><a href="/webgl/lessons/zh_cn/webgl-attributes.html">WebGL Attributes</a></li>
<li><a href="/webgl/lessons/zh_cn/webgl-texture-units.html">WebGL Texture Units</a></li>
        </ul></ul>
<ul>
  <li><a href="/docs/">API å¸®åŠ©æ–‡æ¡£</a></li>
  <li><a href="http://twgljs.org">TWGL, ä¸€ä¸ªè½»é‡çº§WebGLè¾…åŠ©åº“</a></li>
  <li><a href="https://github.com/gfxfundamentals/webgl-fundamentals">GitHub</a></li>
</ul>
        </div>
    </div>
    <div class="lesson-comments">
        <div>æœ‰å…³äºWebGLçš„ç–‘é—®? <a href="http://stackoverflow.com/questions/tagged/webgl">åœ¨Stackoverflowæé—®</a>ã€‚</div>
        <div>æœ‰æ„è§æˆ–å»ºè®®? <a href="http://github.com/vinci-mz/webgl-fundamentals/issues">åœ¨GitHubä¸Šæissue</a>ã€‚</div>

        <div id="disqus_thread"></div>
        <script type="text/javascript">
            /* * * CONFIGURATION VARIABLES: EDIT BEFORE PASTING INTO YOUR WEBPAGE * * */
            var disqus_shortname = 'webglfundamentals'; // required: replace example with your forum shortname
            var disqus_identifier = 'WebGL è’™çš®';
            var disqus_title = 'WebGL è’™çš®';

            /* * * DON'T EDIT BELOW THIS LINE * * */
            (function() {
                if (window.location.hostname.indexOf("webglfundamentals.org") < 0) {
                    return;
                }
                var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
                dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
                (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
            })();
        </script>
        <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
        <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    </div>
  </div>
</div>
</body>
<script src="/3rdparty/jquery-1.11.2.min.js"></script>
<script src="/webgl/lessons/resources/prettify.js"></script>
<script src="/webgl/lessons/resources/lesson.js"></script>
<script src="//cdn.webglstats.com/stat.js" defer="defer" async="async"></script>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-59804936-1', 'auto');
  ga('send', 'pageview');

</script>


</html>



